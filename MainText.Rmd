---
title: "Tail associations and their impact on extinction risk"
author: "Shyamolina Ghosh, Daniel Reuman"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=1in,right=1in,top=1in,bottom=1in"
output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: TheAmericanNaturalist.csl
bibliography: Ref_extrisk.bib
---


```{r setup_MainText, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 3) #This option round all numbers appeared in the inline r code upto 5th digit
seed<-101
```

\noindent \emph{Affiliations:}

\noindent Ghosh: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

\noindent Reuman: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA; Laboratory of Populations, Rockefeller University, 1230 York Ave, New York, NY, 10065, USA

<!--
Alternative titles
1) Tail associations in environmental variables and extinction risk
2) The influence of correlations in the extremes on extinction risk
3) Tail associations in environmental variables and their impact on extinction risk
4) Asymmetric tail association in extreme climatic events affects population-extinction risk
-->

\newpage

\noindent \textbf{ABSTRACT} 
<!--200 words limit : J Am Nat-->

<!--***DAN: Dan has not edited this--> 
With global climate change, extreme climatic events (ECEs) become more frequent. These ECEs could pose a severe impact on the resistance or resilience of a population and/ or community level through life-history traits of the species. Therefore predicting the impact of extreme events on population extinction risk is necessary. We here introduce the potential use of "tail association" property of two correlated ecological variables in modeling the extinction risk of an age-structured single patch model. We also extend this idea to density-dependent metapopulation models. For metapopulation models, we show extinction risk not only depends on the nature of the tail association of spatially correlated noise but is also influenced by the inherent dynamics of the population-model. To elaborate, we demonstrate left tail dependent noise across spatially correlated patches cause higher extinction risk than the right tail dependent noise when the model show undercompensatory dynamics. But in the overcompensatory regime, the trend is the opposite. Our study paves the path for future research considering this tail association instead of a simple correlation in population viability analysis.

\textbf{\textit{Keywords:}} extinction risk, extreme events, tail association, density-dependent model

\newpage

```{r read_res, echo=F}
ktau_common<-readRDS("./Results/ktau_common.RDS")
```

# Introduction\label{Introduction}

<!--ECEs have a lot of impacts, it is important to understand their impacts-->
Over the past few decades, extreme climatic events (ECEs) such as
temperature or precipitation extremes, heat-waves, and extreme wildfires
have become more common or more extreme due to anthropogenic climate change 
[@ummenhofer2017extreme]. ECEs are well known to produce severe
impacts at the population, community and ecosystem levels [@bragazza2008climatic; 
@gutschick2003extreme; @jiguet2011community; @mckechnie2009climate;
@felton2017integrating], and thus the goal of improving our understanding of
the variety of ecological impacts of ECEs is an important applied goal for 
modern ecology [@katz2005statistics; @smith2011ecological; @diez2012will; @moritz2013future; @bailey2016tackling]. Frequent extreme events 
can help alter the mean temperature or precipitation of an area, 
can be associated with changes through time in the overall variance of 
climate signals, and can directly contribute to changes in the symmetry or the 
skewness of distributions of climate signals through time 
[@hansen2012perception]. All such changes have the potential to influence 
populations, including their risk of extirpation from an area 
[@GarciaCarerras2013; @Vasseuretal2014].
For instance, @frederiksen2008demographic used $43$ years of ring-recovery data 
to examine the demographic impact of ECEs on European shags 
via their effects on temporal variability in 
juvenile, immature and adult survival rates.
@mcdermott2017sensitivity investigated the sensitivity 
of $41$ UK butterfly species to four different types of ECEs. 
At the community level, research has shown that ECEs can reorder
the dominance hierarchy of species in an area, sometimes leading to 
selective local extinctions, and can also produce effects that cascade 
across trophic levels [@thomas2004extinction; @edgar2010nino; @moreno2011extreme; @hoover2014resistance]. 
For example, @chiu2013impact showed that extreme floods affected 
the annual survival of a prey community, in turn influencing predators in 
aquatic as well as adjacent riparian habitats. 
@dreesen2014successive, in an experimental study, showed that 
ECEs can reduce the ability of plant communities to withstand subsequent ECEs
that occur after a short time interval.

<!--Earlier study on metapopulation extinction risk : Large-scale spatial synchrony 
may also be generated by other processes such as migration and predation, but regional
stochasticity in the form of spatially correlated weather conditions is
probably the dominant synchronizing mechanism (ref: Nature1998) but what about taildep. effect on extrisk?.-->

<!--ECEs have impacts in the spatial context as well-->
ECEs also have impacts in ecological scenarios for which spatial dynamics are
important.
In the metapopulation context, spatial synchrony of population dynamics, which can
be caused by spatial synchrony of climatic fluctuations, is linked to metapopulation
extinction risk [@hanski1998metapopulation; @earn2000coherence].
If ECEs are also spatially more extensive than moderate events,
as seems likely for some types of events, extreme events may accentuate
population synchrony and thereby increase extinction risk.
For instance, a 21-year-long
study of @tack2015increasing on the Glanville fritillary butterfly demonstrated that frequency 
of drought during early larval instars increased the strength and extent 
of spatial synchrony 
over a metapopulation network of 4000 dry meadows, and could thereby influence
the long-term viability of the species in the area of study.

<!--concept for correlation in the extreme tail: tail association-->
Though earlier literature considered the influence of spatial synchrony 
in environmental variables on metapopulation extinction risk, to 
our knowledge the distinct influence of "asymmetric tail associations" between
environmental time series in different locations has hardly been considered. 
"Tail associations" are
associations between two random quantities in their extreme values. 
For instance, if two positively associated 
variables are more closely associated in their smaller values than in their larger values,
they are said to have stronger
"left-tail" or "lower-tail" association (Figure \ref{fig_intro_cop}A, B). 
If two positively associated variables are more associated in their larger 
values than in their smaller values, they are 
said to have stronger "right-tail" or "upper-tail" association 
(Figure \ref{fig_intro_cop}C, D). 
Figure \ref{fig_intro_cop} shows that two variables can have a wide 
range of patterns of tail association, from extreme left- to extreme right-tail
association, with the same overall correlation. So tail association
is a distinct concept from correlation itself, and may have distinct ecological
ramifications [@Ghosh_copula]. Asymmetric tail associations have been documented 
between environmental variables, and between the same environmental variable 
measured in different places [@Serinaldi2008; @li2013; @She2018; @Goswami2018]. 
Asymmetric tail associations have also been documented between numerous ecological
variables and between environmental and ecological variables [@Ghosh_copula].

<!--ECEs probably produce tail associations-->
There are reasons to believe that ECEs may produce asymmetric tail 
associations between climatic variables
measured in different locations. For instance, if a single ECE is associated
with spatially widespread, large values 
of some climatic variable, but small values of the
variable are associated with local weather rather than ECEs, the result could
be stronger right-tail association between measurements of the climatic variable
made in different locations, through time.
For example, rainstorms which deposit exceptionally large amounts of rain
may do so over large areas; but months with less rain may experience
scattered showers only, which may be much less correlated across locales.

<!--***DAN: May be scope for a discussion para linking what is known about
how ECEs are changing to what effect that may have on how tail assiciations
in environmental variables might be changing, and what influence that may have
on extinction risk. If little is known, then this might be a good topic for 
future work.-->

There are also reasons to hypothesize that asymmetry of tail association in 
environmental variables may influence extinction risks for metapopulations.
For instance, assuming for the sake of a simple example that low values of an environmental
variable are "bad" for populations of a given species and high values are "good",
greater left-tail associations between measurements of the variable in different
habitat patches may cause higher metapopulation extinction risk because then
very bad years for component populations would occur at the same time in 
many patches, reducing the potential for rescue effects. Greater left-tail associations
would probably not have the same effect, even if overall correlations between locations
were the same, because in that case it would be very good years for the component 
populations that would occur at the same time in many patches [@Ghosh_copula]. 
@Ghosh_copula substantiated this intuition by showing that it held true for a 
modeling setup using a spatial version of a very simple non-density dependent
population growth model (the Lewontin-Cohen model). In essence, if environmental
"catastrophes" (i.e., extremely bad years for a population) are widely 
spatially synchronized it should create much greater metapopulation extinction 
risk than if "bonanzas" (i.e., extremely good years) are widely synchronized, even
if overall (non-tail-specific) levels of environmental synchrony are the same
in both these cases. The present study extends tests of this idea to metapopulation
models incorporating density dependence. 

Extinction risk is also very commonly estimated for age-structured models 
such as stochastic matrix models [@MorrisDoak2002; @Caswell2006] and 
integral projection models
[@Merowetal2014]. For such models, extinction risk depends, in part, on the long-term
population growth rate, a population parameter which in turn 
depends on the means, variances and covariances of population vital rates such 
as the survival and fecundity rates of age classes. Extinction risks may,
*a priori*, also depend on possible asymmetries of tail association between
population vital rates. For instance, it seems reasonable to imagine
a case in which both adult fecundity and juvenile survival rates 
depend on an environmental variable such as spring rainfall in similar ways, but 
only when that variable takes very low values. When rainfall takes
typical or high values, fecundity and survival may be limited instead 
by different factors. This could produce left-tail dependence between these 
vital rates, possibly resulting in different extinction risk for the model
compared to a case in which vital rates were symmetrically associated in 
their tails but otherwise statistically similar. 

<!--objectives, last para of intro-->
In this paper, we will explore the potential for asymmetric tail associations to 
influence extinction risk in populations and metapopulations. Specifically,
we will address the following sets of questions. Q1) Can the nature of tail associations
between vital rates in an age-structured population model influence
extinction risk for the model, and to what extent? Q2) Does the nature
of tail associations between measurements of an environmental variable in different
locations influence the extinction risk of a density-dependent metapopulation model
that depends on the environmental variable? How does the nature of the density
dependence mediate this influence? Will density dependence reverse or reproduce
the earlier result [@Ghosh_copula], using non-density-dependent models, that 
left-tail dependence in environmental variables accentuates and right-tail dependence 
mitigates extinction risks?
For Q1, we simulate a simple 2-stage model. We hypothesize that left-tail dependence
between juvenile survival and adult fecundity rates increases extinction risk
relative to right-tail dependence, even when the overall correlation is kept fixed. 
For Q2, we simulate spatial extensions of several simple and commonly
used population models. We intentionally use a simulation approach and simple models
instead of attampting mathematical analysis and/or using realistic models
because our intention here is to provide an initial exploration only of 
the potential mechanisms outlined above which suggest that
asymmetries of tail association may make a difference for extinction risks. 
<!--***DAN: In Discussion need to talk about what analytic results are needed
to take the next step of determining when tail depencence may make enough of
a difference to think about. I think our results, together with Tulja's 
approximation, suggest that tail associations probably don't make much difference
for models without a spatial component. But our results illsutaret that it can
make a big difference when there is a spatial component, apparently because of 
the influence of tail associations on rescue effects. Could maybe even outline
analytic approaches for non-dd models? Not sure what would be done with dd
models. The point is you need to take the next step in the Discussion of 
talking about how our results, which admitedly are just for specific models,
could be turned into analytic results or general results.-->
Though tail associations are used
to assess risks in fields such as finance and hydrology 
[@alexander2008market; @li2013; @chen2011flood; @Goswami2018], to our
knowledge asymmetric tail associations have rarely been assessed for their
importance for extinction risks of populations and species (but see @Ghosh_copula). 
Our questions are an important step for understanding
the potential influence of ECEs on extinction risks if ECEs are associated with
tail dependence in environmental variables. 

<!--
How does environmental noises with asymmetric tail association across multiple patches
influence extinction risk of a density-dependent metapopulation model? Our speculation 
is that the general finding from density-independent metapopulation model [@Ghosh_copula]
(higher extinction risk if noises across patches were left-tail dependent than the one 
if noises had right-tail association) would hold true only in the under-compensatory regime, but 
should be reverse if the model shows over-compensatory dynamics. 
(Q3) We further hypothesize that when there is no dispersal, the above-said switching should occur
near the critical parameter value where the deterministic model shows transition from 
under-compensatory to over-compensatory dynamics.-->

<!--FIG : pedagogical fig showing 4 types of tail associations: 
extreme left, moderate left, moderate right, extreme right-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=15 cm]{./Results/introfig_copula.pdf}
\caption{Two stochastic quantities can have same Kendall 
correlation, but different degrees of tail association: 
(A) extreme left-tail association, (B) moderate left-tail association, (C) 
moderate right-tail association, and (D) extreme right-tail association.
In all cases, Kendall's $\tau$ was the same, $\tau = 0.75$,
up to sample variation (the sample correlation for each dataset is displayed
on its panel). The extreme left-tail (respectively, right-tail) dependent 
case is perfectly correlated below (respectively, above) the threshold of 0.
See Methods for information on how bivariate noise was generated with
asymmetric tail associations.
\label{fig_intro_cop}}
\end{center}
\end{figure*}
<!--***DAN: Shyamolina, it occured to be there are simple and good analytic reasons
why ktau_common is exactly 0.75 (up to sample variation). 
I bet you will see them too if you look up the
definition of kendall tau and think about the extreme tail dependent cases. 
Currently, around line 50 of the sup mat Rmd, you calculate ktau_common
by simulating 100000 points from the extreme-tail-denepdnece noise and then
calculating the sample kendall. Instead, can you please replace those lines 
with the simple line "ktau_common<-0.75"? I would do this myself but I
don't want to risk messing up your code in some way I don't understand. You should not
need the seed anymore to ensure you get the same ktau_common on each run
since you won't be using the sample correlartion anymore to estimate ktau_common,
you'll just be using the analytic result that the population correlation
of data from the extreme-tail-dependent algorithm (in the limit of infinite
sample sizes) is exactly 0.75. Please
let me know if you do not understand something here.-->
<!--***DAN: Shyamolina, currently the sample kendalls are the same on A and D, and
also on B and C, and I know why. This looks weird, and makes the reader
wonder why this is the case. Rather than plotting the reversed version of the
data from A on D, and the reversed version of the data from B on C, can you plase
generate separate, independent data for A and D, and also for B and C? That
will have the effect of making the sample kendalls on the 4 panels slightly
different, which will mean readers think anything funny is going on.-->

# Methods\label{Methods}

<!--stochastic matrix model : age-structured-->
To investigate Q1 from the \nameref{Introduction},
we considered a simple stochastic age-structured model
with two age classes, 
\begin{equation}
\left({\begin{array}{cc} E(t+1) \\ A(t+1) \end{array}}\right) = 
\left(\begin{array}{cc} 0 & f_a(t)\\ s_e(t) & 0 \end{array}\right)
\left(\begin{array}{c} E(t) \\ A(t) \end{array}\right), \label{eq_age_str}
\end{equation}
\noindent where $E(t)$ and $A(t)$ are the numbers or population densities of eggs 
and adults, respectively, at time $t$. We chose a very simple model
because our goal was to carry out an initial evaluation, only, of 
the realism of a potential mechanism. The stochastic vital rates $s_e(t)$ and $f_a(t)$
were selected, independently across times, as follows. 
The egg survival rate $s_e(t)$ was drawn from a beta distribution with parameters
$\alpha=3$ and $\beta=2$. 
Adult fecundity was $f_a(t)=\tilde{f}_a(t)\exp(-A(t)/\Omega)$, where $\tilde{f}_a(t)$
was drawn from a gamma distribution with shape and scale parameters $k=2$
and $\theta=1$, respectively, 
and $\Omega$ is a density dependence parameter. Taking $\Omega=\infty$ made
$\exp(-A(t)/\Omega)=1$ so that the model did not include density dependence
(it was then a standard stochastic matrix model). Finite, positive values of 
$\Omega$ made the model nonlinear, with density dependence in the adult
fecundity rate.  

The stochastic quantities $s_e(t)$ and $\tilde{f}_a(t)$ were generated 
to have the same overall association (Kendall's $\tau$ equal to $0.75$,
up to sampling variation), but different degrees and types of 
asymmetry of tail association in different simulations, as follows.
For a simulation of length $T$, we used methods that can 
generate $T$ independent pairs $(u(t),v(t))$ for $t=1,\ldots,T$ with
$\tau=0.75$ (up to sample variation), but with either extreme left-,
moderate left-, moderate right-, or extreme right-tail association 
(e.g., Fig. \ref{fig_intro_cop}). The methods we used generated
$(u(t),v(t))$ such that $u(t)$ was uniformly distributed on $(0,1)$,
and likewise for $v(t)$. We then applied a monotonic transformation
to the $u(t)$ so that the resulting numbers were distributed according to
a beta distribution with parameters
$\alpha=3$ and $\beta=2$ 
and used those values for the $s_e(t)$. We also applied a (different)
monotonic transformation to the $v(t)$ so that the resulting numbers were
distributed according to a gamma distribution with parameters $k=2$
and $\theta=1$ and used those values for the $\tilde{f}_a(t)$. Because
the $u(t)$ and $v(t)$ were uniformly distributed, the inverse 
cummulative distribution functions of the desired beta and
gamma distributions were the transformations. Because these
were monotonic transformations, the Kendall correlation of 
$s_e(t)$ and $\tilde{f}_a(t)$ was the same as that of 
$u(t)$ and $v(t)$. The quantities $(u(t),v(t))$ for $t=1,\ldots,T$ were
generated as described in Appendix \ref{SM-makenoise}.

<!--calculation of ext risk with age-structured model-->
To calculate extinction risk for a given $\Omega$ and choice of tail dependence, 
we simulated the model for $25$ time steps, $10000$ times,
each simulation starting from $E(t)=5$ and $A(t)=10$. The population for a simulation
was considered to have gone extinct if the total population $E(t)+A(t)$ ever 
went below an extinction threshold (we used a threshold of $2$) within the 
$25$-time-step time horizon. Extinction risk was the fraction of $10000$
simulations that went extinct.

<!--***DAN: Shyamolina, the below text makes me wonder if I am misunderstanding something, please
explain. The part that confuses me is the 2.5th and 97.5th quantile part, what is the meaning
of that and what does it have to do with extinction riks? I would have thought extinction risk
was just the fraction of 10000 sims that went extinct.

after each time step, we simulated model (\ref{eq_age_str}) for $25$ years
with $10000$ simulations. For each simulation, we started with initial population $(E,A)_{t=0} = (5,10)$
and following Eq. \ref{eq_age_str} we checked whether after each time step the total population $(E+A)_{t}$
was below a certain extinction threshold (we set it as $2$) or not. If total population was below that threshold then we 
considered population went extinct for that simulation. We also calculated $2.5^{th}$ and $97.5^{th}$ quantiles
of $10000$ simulations with the probability of computed extinction risk at each time step (see [`code`](https://github.com/sghosh89/ERC/blob/master/ext_risk_cop_age_str.R)).
-->

<!--density-dependence metapopulation model-->
To investigate Q2 from the \nameref{Introduction}, we considered spatialized, stochastic versions
of six density dependent population models, the Ricker, Hassell, Maynard Smith, Pennycuick, Verhulst, 
and Austin-Brewer models (@cohen1995unexpected; Table \ref{tab_model_summary}).
All models took the general form $\vec{P} (t+1) = D \lambda(t) \vec{P}(t)$,
where $\vec{P}(t)$ is a vector of population densities, 
the $i^{\text{th}}$ component $P_i(t)$ representing
the population density in the $i^{\text{th}}$ habitat patch ($i=1,2,\ldots,n$) at time $t$. 
The $n \times n$ matrix $\lambda(t)$ was diagonal with $i^{\text{th}}$ diagonal entry 
$\lambda_i(t)$ depnding on the model used (see Table \ref{tab_model_summary}). The matrix $D$
was an $n \times n$ dispersal matrix. For simplicity, 
we assumed the $n$ habitat patches were arranged, evenly spaced, in a line.
We considered both "local" and "global" dispersal among patches in different simulations. 
For local dispersal, a fraction $d$ of 
each population dispersed during each time step, equally distributed to
the two or one nearest neighbors. For global dispersal the same fraction $d$ dispersed
equally to the other $(n-1)$ patches. When $d$ was $0$, dispersal did not occur and 
rescue effects were not possible.
Two models that @cohen1995unexpected used were excluded from our analyses because they were not
readily adapted to our simulation setup: the Varley model,
which is not continuous;
<!--***DAN: Shyamolina, looking back at the Cohen paper, using the value C=1 as they used, the
Varley model *is* continuous. It is not differentiable, but it's not clear to me that 
non-differentiability means we cannot use the model. Let's discuss.-->
and the Malthus-Condorcet-Mill model, which employs a logarithm of the population and therefore
cannot be applied in the context of extinction.
<!--***DAN: go back and look at that model when you get the paper and remind yourself-->

<!--***DAN: got to here 2019 10 25-->

We simulated our metapopulation models with noises $(\epsilon_t^i)$ that were 
independent through time with same spatial correlations 
between patches (to within sampling error)
for every simulation, but were moderately (or extremely) left- and 
right-tail associated between patches in
different simulations. For moderately left-tail associated 
noises we drew points from a $n$ dimensional 
Clayton copula with same Kendall correlation ($\tau =$ `r ktau_common`) between
any two out of $n$ patches and made 
the marginals normal with zero mean and standard deviation $\sigma$ 
(see the specified value $\sigma$ for each model in 3$^{rd}$ 
column of Table \ref{tab_model_summary}). For moderately 
right-tail associated noises we flipped ($180^{\circ}$ rotation) the points drawn 
from Clayton copula so that all the statistical properties remained 
same except for the direction of tail association. We generated
extreme left- or right-tail associated noises via algorithm stated in 
Appendix \ref{SM-extr_tail_dep}. Our models (Table \ref{tab_model_summary}) 
computed extinction risk after $25$ years for $10000$ simulations at $n = 5$ patches
with spatially correlated noises having either moderate or extreme tail 
association in left and right-tail. <!--say how you set ext. threshold = Pe/10-->
We started with initial population $P_{t=0}^i = P_e^i, (i = 1,2,\ldots,n)$ for each patch, where 
$P_e^i$ was the equilibrium value (or similar to carrying capacity concept) 
for each density-dependence model (see 4$^{th}$ column of Table \ref{tab_model_summary}).
We assumed the population went extinct after each time step if it was below a 
certain threshold (set to 10\% of the initial population $P_e$ for individual model). 

The models stated in Table \ref{tab_model_summary} had one common 
feature: they showed undercompensatory
dynamics (monotonic approach towards stable steady state $P_e$) when
growth parameter $r$ remained below a critical 
level (say, $r_c$) and overcompensatory dynamics with oscillatory approach 
towards stable equilibrium $P_e$ when $r$ was beyond $r_c$. 
If $r$ became too high and exceeded $r_{bf}$ - the parameter value responsible for Hopf-bifurcation -
model equilibrium $P_e$ became unstable. Beyond the Hopf-bifurcation point, the model showed sustained
oscillation and eventually led to chaos with increasing $r$. Appendix \ref{SM-model_stability}
summarized the stability analysis of each model in their deterministic form.

<!--test hypothesis from Q2 : ext risk with density-dependence metapopulation model with r from different regime-->
To answer (Q2) of \nameref{Introduction} for each metapopulation model,
we estimated extinction risk for a wide range of parameter $r$ 
that covered the undercompensatory and overcompensatory regime. We 
chose equispaced values of $r$ from the 95\% quantiles 
of possible range ($r_{min},r_{bf}$), where $r_{min}$ was the minimum value of $r$ 
to get a positive, finite equilibrium $P_e$ (for details, see Appendix 
\ref{SM-model_stability}) to start with (at $t=0$). For each chosen $r$,
we calculated extinction risk after $25$ years with each metapopulation model 
where population could disperse locally (or globally) with varying dispersal 
rate $d= 0,0.1,0.2,..0.5$ and moderate to extreme left 
tail- and right-tail associated environmental noises with same Kendall's $\tau$ (= `r ktau_common`)
in different simulations (for code see [`mydispersal.R`](https://github.com/sghosh89/ERC/blob/master/mydispersal.R)).

We plotted extinction risks along the y-axis
for both left tail and right tail associated noises 
against the varying range of $r$ along x-axis when no dispersal ($d=0$) was considered.
We excluded the possibility of dispersal to avoid any rescue effect among patches. 
For each model with extreme (or moderate) left- and right-tail associated noises, we calculated 
2.5$^{th}$ and 97.5$^{th}$ quantiles
of 10000 simulations with the probability of computed
extinction risks at each $r$. We compared $r_c$ and the value of $r$ at which 
95\% CI of extinction risks from both noises overlapped
with each other. This could give us an idea of how extinction risks affected by the model parameter 
$r$ that controlled the underlying dynamics of the model, i.e., undercompensatory 
or overcompensatory.

# Results\label{Results}

<!--Q1 : age-structured results : linear and nonlinear model with asymmetric copula-->

For single patch linear age-structured models, we found higher extinction risk for moderate left-tail 
association (modeled by Clayton copula) in fluctuating vital 
rates compared with the one when vital rates were right tail dependent (modeled by Survival Clayton copula).
It was expected because an extreme "bad" year (e.g. with severe cold) can suppress 
the fecundity of adult and survival/ maturation of eggs simultaneously 
and thereby can increase the extinction risk of the population. For non-linear age-structured 
models, we got a similar trend for extinction risks with the different tail associations (left and right).
The non-linear model showed higher extinction risk than its corresponding 
linear analog as it was evident from Eq. \ref{eq_vitalrates} with finite $\Omega = 100$. 
Fig. \ref{fig_extrisk_agestr} represents this scenario when vital rates have moderate to extreme tail association in either tail but with same Kendall's correlation ($\tau =$ `r ktau_common`). Extinction risks for two different tail-dependent vital rates were not strinkingly different (e.g. see pair of red and
blue lines in Fig. \ref{fig_extrisk_agestr}A or B) and we anticipated the difference being partly 
dependent on the degree of tail association. Therefore we repeated the same analysis with 
vital rates coming from extreme-tail dependent (left and right in two different simulations)
copulas and got similar results but with much prominent difference between their extinction risks
(Fig. \ref{fig_extrisk_agestr}C or D). This result answered (Q1) and showed extinction risk of 
a population could be considered as a direct manifestation of tail association property 
between vital rates of different age-class
of that population. <!--discussion later: add Tuljapurkar's approximation-->

<!--Q2 : metapopulation results : density dependence with extreme tail dep. copula-->

We found density-dependent metapopulation models in stochastic 
environment showed similar patterns for extinction risk as density-independent 
metapopulation model did in a recent study [@Ghosh_copula]. For each density-dependent 
model listed in Table \ref{tab_model_summary}, we observed higher extinction risk for 
the metapopulations when spatially correlated noises were left-tail associated 
than the one with the right-tail association. But that observation remained 
valid when the model parameter - here considered as growth rate $(r)$ - was 
sufficiently low so that under-compensatory dynamics (monotonous approach towards
its stable equilibrium) for the deterministic analog of the model was ensured.
We observed right tail associated noise caused higher extinction 
risk for the metapopulations than left tail associated noise when the model 
was in over-compensatory regime (oscillatory approach towards stable equilibrium) for higher 
value of $r$. Fig. \ref{fig_extrisk_allmodel_localdisp} shows
variation of extinction risk against local dispersal rate ($d$) for 
six density dependent metapopulation models (see Table \ref{tab_model_summary}) with growth 
rate $r$ considered either from under-compensatory or 
from over-compensatory regime. This finding addresses (Q2) from \nameref{Introduction}. We 
also got similar results 
for global dispersal (Fig. \ref{SM-fig_extrisk_allmodel_globaldisp}). 
Figs. (\ref{SM-fig_ricker_risk_local_disp_scl_1} - 
\ref{SM-fig_risk_local_disp_abrewer_r_vary_scl_0.6}) 
demonstrate how extinction risk changed against local dispersal rate for a whole range
of $r$, whereas Figs. (\ref{SM-fig_ricker_risk_global_disp_scl_1} - 
\ref{SM-fig_risk_global_disp_abrewer_r_vary_scl_0.6}) 
represent the same but for global dispersal among patches. 
Both case showed the signature of "rescue-effect" (i.e. reduced the extinction risk for 
finite dispersal compared with $d=0$).

<!--Q3 : metapopulation results : switching near rc for d=0-->
Following Figs. (\ref{SM-fig_ricker_risk_local_disp_scl_1} - 
\ref{SM-fig_risk_global_disp_abrewer_r_vary_scl_0.6}) one can reasonably hypothesize
that the switching between the extinction risk 
generated by left-tail associated and right-tail associated noise 
occurred near the critical parameter $r_c$. For simplicity, we only considered 
$d=0$ case, i.e., when there was no dispersal between patches. 
Fig. \ref{fig_extrisk_d0} demonstrates higher extinction risk 
with left-tail associated noise for $r<r_c$ and with right-tail associated noise 
for $r>r_c$. $r_c$ was the vertical line in Fig. \ref{fig_extrisk_d0} 
indicating the value of $r$ for each model where their deterministic analog switches 
from under- to over-compensatory dynamics. Though the switching visually appeared far away
from the theoretical $r_c$ value for Verhulst and Austin-Brewer model, they were 
consistent with our hypothesis as they had comparatively a smaller range of $r$ than the other models.


# Discussion\label{Discussion}

<!--summary results:-->
We showed the potential use of the "asymmetric" tail association in modeling the impact of 
extreme ecological events on population-extinction risk. Our results demonstrated left and right-tail 
association in vital rates (or in spatially correlated environmental noises) affected extinction risk differently
in years of extreme events ("catastrophes" and "bonanzas"). Though we could expect the left tail association 
to show higher extinction risk than the one for right tail association with age-structured 
and density-dependent metapopulation models, it was not always true. In the over-compensatory regime,
right tail dependent noise caused higher extinction risk than the left tail dependent noise. We showed 
that in the absence of dispersal the above-said switching took place near the critical parameter value where 
the deterministic model showed the transition from under-compensatory to the over-compensatory regime.

<!--Tuljapurkar approximation : linear version of age-structured model in stochastic environments-->
We found a left tail association in vital rates (induced by ECEs) caused higher extinction risk than 
the right tail dependent ones, but the difference was not remarkable 
unless the tail association was at its 
extreme (Fig. \ref{fig_extrisk_agestr}). This finding could be explained 
by the approximation @tuljapurkar1990lecture made for the 
stochastic log(growth rate) in an iid environment.
The approximation considered growth rate being 
dependent on the most dominant eigenvalue of the mean projection matrix 
and the temporal variance of the log(population growth rate) caused 
by environmental stochasticity - which was based
on the linear covariance measure between any 
two matrix elements, not on their tail association properties. Therefore,
following @tuljapurkar1990lecture, the population growth 
rate in an iid environment could be approximated
as same for our model (Eq. \ref{eq_age_str}) with 
left-tail or right-tail association.

<!--Intution/ possible explanation for expected results/ hypo?-->



<!--future study: worthy for PVA, IUCN red list:
1. Identify which life stage or demographic process as management target?
2. Old study (Doak1994, Ferguson1995) showed including correlation btw vital rates for PVA makes a difference, 
   what if we include TD through copula? Multisite age str. model with dispersal, directional change
   in spatio-temporal variation for vital rates.
3. Tdep. with -ve correlation between vital rates?
4. extinction risk how propagated through a food web?
5. Not sure : see McCarthy2000: Most previous models of metapopulation viability have either ignored
correlated extinction of patches, or have included uniform correlations, with the correlation between 
nearby patches being the same as the correlation between distant
patches (Hanski 1994; Tilman et al. 1994; Lindenmayer et al. 1995; McCarthy
1996). 
-->
Although we demonstrated that tail association between vital rates of an age-structured model can
influence extinction risk, substantial work remains to determine the importance of this effect in the 
following scenarios. First, we demonstrated the effect of the tail association on extinction risk 
with a basic age-structured (two age stages) model where we considered the total semelparous 
population would go extinct if there would be only one female adult and one egg. But in reality population 
viability analysis (PVA) deals with a little bit higher threshold with several age, stage or size class and a variety 
of populations including semelparous and iteroparous [@morris2002quantitative]. Future studies should include 
tail association effect on extinction risk 
for a multiple age-, size- and stage-structured model and estimate extinction risk 
for each age, size and stage class separately 
so that we can identify (via multisite-PVA) which life-stage or demographic process 
to target for population management. An earlier study by @doak1994modeling showed PVA models with correlated 
demographic rates indicated a marked difference in predicting confidence interval for 
future population size compared with the model which did not include correlation. But when 
such correlation cannot be estimated directly, more generally where the
forms of statistical dependence among the model's parameters are unknown, making incorrect
assumptions about correlations and dependencies may lead to severe over-estimation 
or under-estimation of extinction risks [@ferson1995correlations]. We believe modeling 
dependencies with copula could help in this case. Second, we did not consider multiple sites of 
age-structured metapopulation which could be linked via dispersal. So, the possible future investigation 
would be to explore the viability for the metapopulations if vital rates (e.g. fecundity or 
survival of different stage class) across sites showed specific tail association 
with spatially correlated extreme climatic events. Third, we considered the tail association 
between positively correlated vital rates, but what would be the extinction risk 
and viability of a population if demographic rates were negatively correlated with the asymmetric tail association. 
We could consider this scenario to model extreme events that kill adults and allow more successful
recruitment of seeds or other propagules. Fourth, following the aforementioned idea, it would be worthy 
to model more complex prey-predator model where asymmetric tail association could feature the
interspecific-dependence. An earlier study [@carnicer2011widespread] showed extreme events
(i.e., heatwaves and droughts) increased mortality and defoliation in the southern European forest and its 
dependent herbivorous insects and fungi through trophic linkage. <!--ECEs can even truncate 
multiyear insect outbreak dynamics [@esper20061200].--> We believe copula (maybe a multidimensional one) has 
a lot more potential to estimate the risk of cascading extinction in model food webs. <!--should I mention about 
match-mismatch hypothesis leads to extinction? our phenology paper in prep.--> Fifth, we considered 
our metapopulation patches were equispaced on a linear chain with equal global dispersal 
rate between patches. But in realistic network models, as inter-patch distances 
can be different, the dispersal rate should depend on distance: dispersal is possible at higher 
rates between nearby patches than the patches which are far away. It is worthy to study 
metapopulation viability with non-uniform spatial correlation (i.e. asymmetric tail association) in a 
network with different clusters having various dispersal rates.

 <!--FIG : age structure model results : linear, nonlinear-->
\begin{figure*}[!h]
\textbf{ \hspace{5.4 cm} (A) \hspace{4 cm} (B)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_C_SC_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_C_SC_nonlinear_omg_100.pdf}\\
\end{center}
\textbf{ \hspace{5.4 cm} (C) \hspace{4 cm} (D)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_nonlinear_omg_100.pdf}
\caption{Extinction risk against time from single patch age-structured linear ($\Omega = \infty$) $(A, C)$ and nonlinear ($\Omega = 100$) $(B, D)$ models for $10000$ simulations; shading represents 95\% confidence interval. $(A, B)$ show extinction risk with time when fecundity of adults and survival of eggs have a moderate left tail (LT) or a moderate right tail (RT) association, $(C, D)$ show the analogous scenario but with the extreme tail association between vital rates. \label{fig_extrisk_agestr}}
\end{center}
\end{figure*}

<!--FIG :  summary : all nonlinear model results for local dispersion : extrisk vs. d-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=14.5 cm]{./Results/allmodel_ext_risk_local_disp_extreme_and_moderate_noise.pdf}
\caption{Extinction risks are computed after $25$ years for six nonlinear density-dependence models (Table \ref{tab_model_summary}) with local dispersal among $n=5$ patches and for $10000$ simulations. Spatially correlated 
noises have varying degree of tail associations (extreme left tail, moderate left tail, moderate right tail and extreme right tail) as introduced in Fig. \ref{fig_intro_cop}. Last two columns represent variation of extinction risk against dispersal rate ($d$), calculated for intrinsic growth rate $(r)$ taken from under-compensatory and over-compensatory regime of deterministic model analog.\label{fig_extrisk_allmodel_localdisp}}
\end{center}
\end{figure*}


<!--FIG : all nonlinear model results, d=0, extrisk vs. r-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=12 cm]{./Results/common_legend_extreme_and_moderate_noise.pdf}\\
\includegraphics[width=6 cm]{./Results/ricker_scl_1/ricker_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/hassell_scl_1/hassell_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=6 cm]{./Results/msmith_scl_0.8/msmith_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/pennycuick_scl_1/pennycuick_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=6 cm]{./Results/verhulst_scl_0.6/verhulst_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/austinbrewer_scl_0.6/abrewer_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\caption{Transition of higher to lower extinction risk (calculated after $25$ years) for 
the metapopulations affected by extreme left tail dependent noise across
$5$ multiple patches without dispersal ($d=0$), as intrinsic 
growth rate ($r$) goes from under to over-compensatory regime. Extinction risk for 
extreme right tail dependent noise follows the opposite trend.
Error bars represent the standard errors associated with $10000$
simulations for extinction risk computed at each $r$. Dotted line represents the value of $r$
for each model where their deterministic analog switches from under- to over-compensatory dynamics.
\label{fig_extrisk_d0}}
\end{center}
\end{figure*}

<!--Summary tables for 6 nonlinear models used-->
```{r read_tab_model_summary,echo=F, results='asis',message=F}
library(kableExtra)
library(dplyr)
dt<-readRDS("./Results/tab_model_summary.RDS")
knitr::kable(dt, escape=F,
             format="latex",digits=3, align="c",table.env='table*',
             caption = "Summary of six density dependence metapopulation models considered for each patch; last three columns indicate equilibrium population value ($P_e^{i}$), critical growth rate ($r_c^{i}$ : transition point from under- to over-compensatory dynamics of deterministic models) and bifurcation parameter ($r_{bf}^{i}$ : transition point from stable to unstable equilibrium of deterministic models), respectively. Superscript $i=1,2,...,n$ indicates index for $i^{th}$ patch.\\label{tab_model_summary}",
             booktabs=T, linesep = "\\addlinespace"
             )%>%column_spec(c(1,3,5,6),width="1.4 cm")%>%kable_styling(latex_options = "basic",position = "center")%>%column_spec(2, width = "3.8 cm")
```


\clearpage

# Literature cited

\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{1pt}
\noindent




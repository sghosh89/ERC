---
title: "Main text : Effect of copula on extinction risk"
author: "Shyamolina Ghosh"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: TheAmericanNaturalist.csl
bibliography: Ref_extrisk.bib
---


```{r setup_MainText, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 5) #This option round all numbers appeared in the inline r code upto 5th digit
seed<-101
```


# Introduction

objectives:

1) Nature of tail dependence in environmental noise (or in vital rates) affects extinction risk of a population differently.
       - Age structure stochastic matrix model : extrisk of left tail dep. > extrisk of right tail dep.
         (This difference is small, could be explained by Tuljapurkar's approx. for linear model, see discussion)
        
       - 6 Density-dependent models with extreme tail dep. in noise (local/ global dispersal)
           - extrisk depends on tail dependnece as well as on model parameters (under-compensatory, over-compensatory)
           - Rescue effect ??
           - H0 : switching occurs near rc (without dispersal)


# Methods

<!--stochastic matrix model : age structured-->
To investigate how copula structure in noisy environment affect the extinction risk of
populations in a single patch age-structured model,
we considered a simple stochastic age-structured model (Eq. \ref{eq_age_str}) 
with two age classes: 
one is egg ($E$) and the other is adult ($A$). We assumed
the population was semelperous, i.e., adult ($A$) went through the
reproductive episode only once before death. Eggs and adults in the 
next generation depend upon the fecundity of adult ($f_a \geq 0$) 
and survival of eggs ($0 \leq s_e \leq 1$) from present generation, respectively.
The environmental stochasticity in the model was embedded in 
the fluctuating vital rates ($f_a$ and $s_e$). We considered the fecundity ($f_a$)
and survival ($s_e$) rates were random draw from a gamma ($\Gamma(k,\theta)$) and
a beta ($\mathcal{B}(\alpha,\beta)$) distribution, respectively. These distribution 
could be generated from iid noises showing specific tail-dependence (left or right tail)
between fecundity and survival rates. Eq. \ref{eq_vitalrates} represent the stochasticity 
in the vital rates. Demographic stochasticity was also taken into consideration when 
we included the density dependence effect in one of the vital rate, namely, fecundity ($f_a$).
If $\Omega = \infty$ in Eq. \ref{eq_vitalrates}, the projection matrix was independent
of populations from any age-class and the model was then called to be "linear", whereas
its "nonlinear" version had finite $\Omega$. 

\begin{equation}
\left({\begin{array}{cc} E \\ A \end{array}}\right)_{t+1} = 
\left(\begin{array}{cc} 0 & f_a\\ s_e & 0 \end{array}\right)
\left(\begin{array}{c} E \\ A \end{array}\right)_{t} \label{eq_age_str}
\end{equation}

\begin{equation}
f_a = \Gamma (k, \theta)\exp(-A/\Omega), \hspace{0.2 cm} s_e = \mathcal{B}(\alpha,\beta) \label{eq_vitalrates}
\end{equation}

<!--calculation of ext risk with age-structured model-->
To calculate extinction risk after each time step, we simulated model (\ref{eq_age_str}) for $25$ years
with $10000$ simulations. For each simulation, we started with initial population $(E,A)_{t=0} = (5,10)$
and following Eq. \ref{eq_age_str} after each time step checked the total population $(E+A)_{t}$
was below a certain extinction threshold (we set it as $2$) or not. If it was below that threshold then we 
considered population went extinct for that simulation. We also calculated $2.5^{th}$ and $97.5^{th}$ quantiles
of $10000$ simulations with the probability of computed extinction risk at each time step.

We repeated the above analysis considering the vital rates coming from a 
an asymmetric copula (Appendix \ref{SM-age_str_vitalrates}) with specific 
left (Clayton, Survival Gumbel)
or right (Survival Clayton, Gumbel) tail dependence
or from an extreme tail-depentdent one, when vital rates were considered to be affected
by extreme climatic events.






<!--density-dependence metapopulation model-->

<!--calculation of ext risk with density-dependence metapopulation model-->





# Results

# Discussion


 
 <!--FIG : age structure model results : linear, nonlinear-->

\begin{figure*}[!h]
\textbf{ \hspace{5.4 cm} (A) \hspace{4 cm} (B)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_nonlinear_omg_100.pdf}\\
\caption{Extinction risk from single patch age structured $(A)$ linear ($\Omega = \infty$) and $(B)$ nonlinear ($\Omega = 100$) models, fecundity of adults and survival of eggs have either extreme left or extreme right tail dependence, numsims=10000. \label{fig_extrisk_agestr}}
\end{center}
\end{figure*}

<!--FIG :  summary : all nonlinear model results for local dispersion : extrisk vs. d-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=15 cm]{./Results/allmodel_ext_risk_local_disp.pdf}
\caption{For each of six nonlinear density-dependence models presented in Table \ref{tab_model_summary} with local dispersal, extinction risk varies as dispersion-rate ($d$) goes from $0$ to $0.5$. Last two columns represent extinction risk calculated for bifurcation parameter $(r)$ taken from under-compensatory and over-compensatory regime of deterministic model analog, respectively.\label{fig_extrisk_allmodel_localdisp}}
\end{center}
\end{figure*}


 <!--FIG : all nonlinear model results with d=0, extrisk vs. r-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=10 cm]{./Results/common_legend.pdf}\\
\includegraphics[width=5 cm]{./Results/ricker_scl_1/ricker_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/hassell_scl_1/hassell_extrisk_d0.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=5 cm]{./Results/msmith_scl_0.8/msmith_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/pennycuick_scl_1/pennycuick_extrisk_d0.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=5 cm]{./Results/verhulst_scl_0.6/verhulst_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/austinbrewer_scl_0.6/abrewer_extrisk_d0.pdf}\\
\caption{Transition of higher to lower extinction risk (calculated after $25$ years) for 
the metapopulations affected by extreme left tail dependent noise across
$5$ multiple patches without dispersal ($d=0$), as intrinsic 
growth rate ($r$) goes from under to over-compensatory regime. Opposite trend
was observed with extreme right tail dependent noise.
Error bars represent the standard errors associated with $10000$
simulations for extinction risk computed at each $r$. Dotted line represents the value of $r$
for each model where their deterministic analog switches from under- to over-compensatory dynamics.
\label{fig_extrisk_d0}}
\end{center}
\end{figure*}

<!--Summary tables for 6 nonlinear models used-->
```{r read_tab_model_summary,echo=F, results='asis',message=F}
library(kableExtra)
library(dplyr)
dt<-readRDS("./Results/tab_model_summary.RDS")
knitr::kable(dt, escape=F,
             format="latex",digits=3, align="c",table.env='table*',
             caption = "Summary of six density dependence models considered for each metapopulation patch with local or global dispersal; last three columns indicated equilibrium population value ($P_e$), critical growth rate ($r_c$) where deterministic analog of models showed transition from under- to over-compensatory dynamics and bifurcation parameter ($r_{bf}$) where $P_e$ became unstable from stable steady state, respectively.\\label{tab_model_summary}",
             booktabs=T, linesep = "\\addlinespace"
             )%>%column_spec(c(1,3,5,6),width="1.4cm")%>%kable_styling(latex_options = "basic",position = "center")%>%column_spec(2, width = "3.5 cm")
```






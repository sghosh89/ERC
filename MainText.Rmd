---
title: "Impact of asymmetric tail-dependence in extreme climatic events on extinction risk in population ecology"
author: "Shyamolina Ghosh"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: TheAmericanNaturalist.csl
bibliography: Ref_extrisk.bib
---


```{r setup_MainText, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 5) #This option round all numbers appeared in the inline r code upto 5th digit
seed<-101
```

\noindent\makebox[\linewidth]{\rule{\columnwidth}{1pt}}

\scriptsize

\textbf{ABSTRACT:}  \small write abstract here



\textbf{\textit{Keywords:}} extinction risk, extreme events, tail dependence, copula, density-dependence model


\noindent\makebox[\linewidth]{\rule{\columnwidth}{1pt}}

\normalsize

# Introduction\label{intro}


We explored the potential of asymmetric tail-dependence in copula 
for understanding the extinction risk of populations towards extreme climatic event in ecology
by addressing the following specific questions: (Q1) Does nature of tail dependence in vital rates
of a single-patch age-structured population model affect extinction risk of that population differently?
We hypothesized population might have higher extinction risk if vital rates are left-tail dependent.
(Q2) How does asymmetric tail-dependent noise across multiple patches influence extinction 
risk of a nonlinear metapopulation model having density dependence? We hypothesized the general finding 
from density-independent metapopulation model [BIVAN paper results of Lewinton-Cohen model]
(higher extinction risk if noise across patches were 
left-tail dependent than the one if noise came from right-tail dependent) holds true only in
the under-compensatory regime, but should be reverse if the model shows over-compensatory dynamics. 
(Q3) We further hypothesize that when there is no dispersal, the above-said switching should occur
near the critical parameter value where the deterministic model shows transition from 
under-compensatory to over-compensatory dynamics.


# Methods

<!--stochastic matrix model : age structured-->
To investigate (Q1) from \nameref{intro} that how copula structure in noisy 
environment affect the extinction risk of
populations in a single patch age-structured model,
we considered a simple stochastic age-structured model (Eq. \ref{eq_age_str}) 
with two age classes (egg $E$ and adult $A$). We assumed
the population was semelperous, i.e., adult ($A$) went through the
reproductive episode only once before death. Eggs and adults in the 
next generation depend upon the fecundity of adult ($f_a \geq 0$) 
and survival of eggs ($0 \leq s_e \leq 1$) from present generation, respectively.
The environmental stochasticity in the model was embedded in 
the fluctuating vital rates ($f_a$ and $s_e$). We considered the fecundity ($f_a$)
and survival ($s_e$) rates were random draw from a gamma ($\Gamma(k,\theta)$) and
a beta ($\mathcal{B}(\alpha,\beta)$) distribution, respectively. These distribution 
could be generated from iid noises showing specific tail-dependence (left or right tail)
between fecundity and survival rates. Eq. \ref{eq_vitalrates} represent the stochasticity 
in the vital rates. We included the density dependence effect in one of the vital rate,
namely, fecundity ($f_a$). If $\Omega = \infty$ in Eq. \ref{eq_vitalrates}, 
the projection matrix would be independent
of populations from any age-class and the model was then called to be "linear", whereas
its "nonlinear" version had finite $\Omega$. 

\begin{equation}
\left({\begin{array}{cc} E \\ A \end{array}}\right)_{t+1} = 
\left(\begin{array}{cc} 0 & f_a\\ s_e & 0 \end{array}\right)
\left(\begin{array}{c} E \\ A \end{array}\right)_{t} \label{eq_age_str}
\end{equation}

\begin{equation}
f_a = \Gamma (k, \theta)\exp(-A/\Omega), \hspace{0.2 cm} s_e = \mathcal{B}(\alpha,\beta) \label{eq_vitalrates}
\end{equation}

<!--calculation of ext risk with age-structured model-->
To calculate extinction risk after each time step, we simulated model (\ref{eq_age_str}) for $25$ years
with $10000$ simulations. For each simulation, we started with initial population $(E,A)_{t=0} = (5,10)$
and following Eq. \ref{eq_age_str} after each time step checked the total population $(E+A)_{t}$
was below a certain extinction threshold (we set it as $2$) or not. If it was below that threshold then we 
considered population went extinct for that simulation. We also calculated $2.5^{th}$ and $97.5^{th}$ quantiles
of $10000$ simulations with the probability of computed extinction risk at each time step.

To test our hypothesis from (Q1), we repeated the above analysis 
considering the vital rates coming from a 
an asymmetric copula with specific 
left (Clayton, Survival Gumbel)
or right (Survival Clayton, Gumbel) tail dependence
or from an extreme tail-depentdent one, 
when vital rates were considered to be affected
by extreme climatic events. A $N \times 2$ matrix, M, was generated
using `BiCopSim` function
from `VineCopula` package 
for each of the left 
(Clayton, Survival Gumbel) and right 
(Survival Clayton, Gumbel) tail-dependent bivariate copulas, 
where $N = numsteps(=25) \times numsims(=10000)$.
We kept the same Kendall's correlation ($\tau = 0.6$) for 
each bivariate copula from one parameter family which used its parameter accordingly
(see `iTau` function from `copula` package). Entries within each clumn of
matrix $M$, were thus 
independent of each others but 
the two columns of $M$ had a specified Kendall's 
correlation ($\tau = 0.6$) and underlying tail-dependence. 
Similarly, for extreme-tail dependence
(either left or right tail) a matrix M with two column was generated as described in 
Appendix \ref{SM-extr_tail_dep}. 

We made the first column of matrix 
$M$ as gamma ($\Gamma(k,\theta)$) distributed. 
$k = 2$ and $\theta = 1$ were shape and scale parameters, 
respectively. This column represented the distribution of fecundity of the adult population, $f_a$.
For a given $\theta$, increasing 
$k$ indicates distribution will shift towards higher fecundity which might 
reduce the extinction risk if the other parameters
remain unchanged. We took the second column of $M$ and applied a 
beta ($\mathcal{B}(\alpha,\beta)$) transformation. $\alpha =3$ and
$\beta = 2$ were the shape parameters which could control the distribution 
of the survival rates of eggs, $s_e$. 
For each $25$ timesteps from each of $10000$ simulations,
the vital rates (fecundity $f_a$ and survival rates $s_e$) 
of the stochastic projrction matrix in model (\ref{eq_age_str})
were drawn pairwise from each row of matrix $M$.
[`sim_age_str`](https://github.com/sghosh89/ERC/blob/master/ext_risk_cop_age_str.R) 
is the function we used to calculate extinction risk for age structured model.

<!--density-dependence metapopulation model-->
We explored (Q2) by examining how nature of the tail dependence of an
environmental variable across space could influence the extinction risk of a 
metapopulation model with density-dependence feedback. We considered six density-dependent 
population-growth models (Ricker, Hassell, Maynard Smith, Pennycuick, Verhulst, Austin-Brewer)
in noisy environment (see Table \ref{tab_model_summary}) 
from a metapopulation context.
Models were adapted from earlier work
by @cohen1995unexpected, excluding only two : Varley model (this is not a continuous one) 
and Malthus-Condorcet-Mill model (terms containing logarithm of extinct population does not make sense). 
All the models could be represented via 
a generalized form : $\vec{P}_{t+1} = D \lambda_t \vec{P_t}$,
where $\vec{P_t}$ was a vector of population densities, 
the $i^{th}$ component $P_t^i$ representing
the density in the $i^{th}$ habitat patch ($i=1,2,\ldots,n$) at time $t$. 
The $n \times n$ matrix $\lambda(t)$ was diagonal with $i^{th}$ diagonal entry 
of stochastic density dependence form $\lambda_i(t)$ (see second column 
of Table \ref{tab_model_summary}). For simplicity, 
we considered $n$ patches in each model were arranged, evenly spaced, in a line
with the provision of "local" or "global" dispersal among patches. A n $\times$ n dispersal
matrix, $D$ was constructed assuming that a fraction $d$ of 
each population patch dispersed during any given time step, equally distributed to
the two or one nearest neighbors in case of local dispersal. For global dispersal, the fraction
$d$ that dispersed
from each patch was divided up equally among all other patches. We called $d$ as dispersal
rate with $d$ being zero there was no dispersal, and threby no chance to rescue an extinct 
patch through migration from nearby metapopulation patches.

The environmental noises from any two patch, say, 
$(\epsilon_t^i, \epsilon_t^j)$ were normally 
distributed within each patch with mean $m=0$ and standard deviation $sd$, 
(see the specified value $sd$ for each model in 3$^{rd}$ 
column of Table \ref{tab_model_summary}), were 
independent through time, and showed the same 
spatial correlations between patches (to within sampling error) for every simulation. 
But they were made to exhibit extreme right- or extreme left-tail dependence between patches in
different simulations. A three dimensional array, numsims $\times$ n $\times$ numsteps, 
$\epsilon$, was made from these extreme tail-dependence noise 
matrix generated via algorithm stated in 
Appendix \ref{SM-extr_tail_dep} and used to calculate extinction risk 
for each of the specified model in Table \ref{tab_model_summary} for $numsteps = 25$ years, $n =$ 5 patches
and $numsims = 10000$ simulations.  

The models stated in Table \ref{tab_model_summary} had one thing in 
common that they showed undercompensatory
dynamics (monotonic approach towards stable steady state $P_e$) when
growth parameter $r$ remained below a critical 
level, say, $r_c$. If $r$ was beyond $r_c$, model showed 
overcompensatory dynamics with oscillatory approach 
towards stable equilibrium $P_e$. But if $r$ became too high and went
beyond $r_{bf}$, the parameter value responsible for Hopf-bifurcation,
model equilibrium $P_e$ became unstable and model could show sustained
oscillation and eventually led to chaos. Appendix \ref{SM-model_stability}
summarizes the stability analysis of each model in their deterministic form.

<!--say how you set ext. threshold = Pe/10-->
We started with $n$ patches of initial population $P_{t=0}^i = P_e^i, (i = 1,2,\ldots,n)$ where 
$P_e^i$ was the equilibrium value (or similar to carrying capacity concept) 
for each density-dependence model (see 4$^{th}$ column of Table \ref{tab_model_summary}).
We assumed population went extinct after each time step if it was below a certain threshold.
That extinction threshold was set to 10\% of initial population $P_e$ for individual model. 

<!--test hypothesis from Q2 : ext risk with density-dependence metapopulation model with r from different regime-->
To test our hypothesis from (Q2) of \nameref{intro} for each metapopulation model,
we estimated extinction risk for a wide range of parameter $r$ 
which covered the undercompensatory and overcompensatory regime. We 
chose equispaced values of $r$ from the 95\% quantiles 
of possible range ($r_{min},r_{bf}$), where $r_{min}$ was the minimum value of $r$ 
for which the model equilibrium $P_e$ had always a finite, positive initial 
population (for details, see Appendix \ref{SM-model_stability}). For each chosen $r$ from each 
model where metapopulation could disperse locally with varying dispersal 
rate $d= 0,0.1,0.2,..0.5$, we calculated extinction risk with left 
tail dependent and right tail dependent environmental noise 
in different simulations, respectively. We also repeated the analysis 
for global dispersal for each metapopulation model. Script 
[`mydispersal.R`](https://github.com/sghosh89/ERC/blob/master/mydispersal.R) was used for this 
analysis.

<!--test hypothesis from Q3 : switching of ext risk with density-dependence metapopulation model with d=0-->
Given hypothesis from (Q2) was valid which scrutinized that whereas 
left tail dependence in noise made extinction risk 
higher in undercompensatory regime ($r < r_c$), it was the 
right tail dependent noise
which appeared to evoke higher extinction risk for metapopulations
in overcompensatory regime ($r > r_c$), we tested our third hypothesis for (Q3).
We considered
the switching to take place near $r_c$, not exactly at $r = r_c$ because the transition point $r_c$
from under to overcompensatory dynamics was expected to differ in stochastic environment than its 
deterministic analog depending on the underlying nonlinearity of the model.
We generated plots with extinction risk along y-axis
for both left tail and right tail dependent noises 
against the varying range of $r$ when no dispersal ($d=0$) was considered.
We excluded the possibility of dispersal in this case to avoid any rescue effect among patches. 
For each model with extreme left and extreme right tail dependent noises, we calculated 
2.5$^{th}$ and 97.5$^{th}$ quantiles
of 10000 simulations with the probability of computed
extinction risk at each $r$. We compared $r_c$ and the value of $r$ at which 
95\% CI of extinction risk from both noises overlapped
with each other. This could give us an idea for supporting our hypothesis.

# Results

# Discussion


 
 <!--FIG : age structure model results : linear, nonlinear-->

\begin{figure*}[!h]
\textbf{ \hspace{5.4 cm} (A) \hspace{4 cm} (B)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_nonlinear_omg_100.pdf}\\
\caption{Extinction risk from single patch age structured $(A)$ linear ($\Omega = \infty$) and $(B)$ nonlinear ($\Omega = 100$) models, fecundity of adults and survival of eggs have either extreme left or extreme right tail dependence, numsims=10000. \label{fig_extrisk_agestr}}
\end{center}
\end{figure*}

<!--FIG :  summary : all nonlinear model results for local dispersion : extrisk vs. d-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=15 cm]{./Results/allmodel_ext_risk_local_disp.pdf}
\caption{For each of six nonlinear density-dependence models presented in Table \ref{tab_model_summary} with local dispersal
among $n=5$ patches, extinction risk after $numsteps = 25$ years for $numsims = 10000$ simulations were calculated.
Extinction risk varies as dispersion-rate ($d$) goes from $0$ to $0.5$. Last two columns represent extinction risk calculated for intrinsic growth rate $(r)$ taken from under-compensatory and over-compensatory regime of deterministic model analog, respectively.\label{fig_extrisk_allmodel_localdisp}}
\end{center}
\end{figure*}


 <!--FIG : all nonlinear model results with d=0, extrisk vs. r-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=10 cm]{./Results/common_legend.pdf}\\
\includegraphics[width=5 cm]{./Results/ricker_scl_1/ricker_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/hassell_scl_1/hassell_extrisk_d0.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=5 cm]{./Results/msmith_scl_0.8/msmith_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/pennycuick_scl_1/pennycuick_extrisk_d0.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=5 cm]{./Results/verhulst_scl_0.6/verhulst_extrisk_d0.pdf}
\includegraphics[width=5 cm]{./Results/austinbrewer_scl_0.6/abrewer_extrisk_d0.pdf}\\
\caption{Transition of higher to lower extinction risk (calculated after $25$ years) for 
the metapopulations affected by extreme left tail dependent noise across
$5$ multiple patches without dispersal ($d=0$), as intrinsic 
growth rate ($r$) goes from under to over-compensatory regime. Opposite trend
was observed with extreme right tail dependent noise.
Error bars represent the standard errors associated with $10000$
simulations for extinction risk computed at each $r$. Dotted line represents the value of $r$
for each model where their deterministic analog switches from under- to over-compensatory dynamics.
\label{fig_extrisk_d0}}
\end{center}
\end{figure*}

<!--Summary tables for 6 nonlinear models used-->
```{r read_tab_model_summary,echo=F, results='asis',message=F}
library(kableExtra)
library(dplyr)
dt<-readRDS("./Results/tab_model_summary.RDS")
knitr::kable(dt, escape=F,
             format="latex",digits=3, align="c",table.env='table*',
             caption = "Summary of six density dependence metapopulation models considered; last three columns indicated equilibrium population value ($P_e^{i}$), critical growth rate ($r_c^{i}$) where deterministic analog of models showed transition from under- to over-compensatory dynamics and bifurcation parameter ($r_{bf}^{i}$) where $P_e^{i}$ became unstable from stable steady state, respectively. Superscript $i=1,2,...,n$ indicates states for $i^{th}$ patch.\\label{tab_model_summary}",
             booktabs=T, linesep = "\\addlinespace"
             )%>%column_spec(c(1,3,5,6),width="1.5 cm")%>%kable_styling(latex_options = "basic",position = "center")%>%column_spec(2, width = "3.8 cm")
```


\clearpage

# Literature cited

\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{1pt}
\noindent




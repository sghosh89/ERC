---
title: "Tail associations and their impact on extinction risk"
author: "Shyamolina Ghosh, Daniel Reuman"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=1in,right=1in,top=1in,bottom=1in"
output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: TheAmericanNaturalist.csl
bibliography: Ref_extrisk.bib
---


```{r setup_MainText, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 3) #This option round all numbers appeared in the inline r code upto 5th digit
seed<-101
```

\noindent \emph{Affiliations:}

\noindent Ghosh: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

\noindent Reuman: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA; Laboratory of Populations, Rockefeller University, 1230 York Ave, New York, NY, 10065, USA

<!--
Alternative titles
1) Tail associations in environmental variables and extinction risk
2) The influence of correlations in the extremes on extinction risk
3) Tail associations in environmental variables and their impact on extinction risk
4) Asymmetric tail association in extreme climatic events affects population-extinction risk
-->

\newpage

\noindent \textbf{ABSTRACT} 
<!--200 words limit : J Am Nat-->

<!--***DAN: Dan has not edited this--> 
With global climate change, extreme climatic events (ECEs) become more frequent. These ECEs could pose a severe impact on the resistance or resilience of a population and/ or community level through life-history traits of the species. Therefore predicting the impact of extreme events on population extinction risk is necessary. We here introduce the potential use of "tail association" property of two correlated ecological variables in modeling the extinction risk of an age-structured single patch model. We also extend this idea to density-dependent metapopulation models. For metapopulation models, we show extinction risk not only depends on the nature of the tail association of spatially correlated noise but is also influenced by the inherent dynamics of the population-model. To elaborate, we demonstrate left tail dependent noise across spatially correlated patches cause higher extinction risk than the right tail dependent noise when the model show undercompensatory dynamics. But in the overcompensatory regime, the trend is the opposite. Our study paves the path for future research considering this tail association instead of a simple correlation in population viability analysis.

\textbf{\textit{Keywords:}} extinction risk, extreme events, tail association, density-dependent model

\newpage

```{r read_res, echo=F}
srho_common<-readRDS("./Results/srho_common.RDS")
```

# Introduction\label{Introduction}

<!--ECEs have a lot of impacts, it is important to understand their impacts-->
Over the past few decades, extreme climatic events (ECEs) such as
temperature or precipitation extremes, heat-waves, and extreme wildfires
have become more common or more extreme due to anthropogenic climate change 
[@ummenhofer2017extreme]. ECEs are well known to produce severe
impacts at the population, community and ecosystem levels [@bragazza2008climatic; 
@gutschick2003extreme; @jiguet2011community; @mckechnie2009climate;
@felton2017integrating], and thus the goal of improving our understanding of
the variety of ecological impacts of ECEs is an important applied goal for 
modern ecology [@katz2005statistics; @smith2011ecological; @diez2012will; @moritz2013future; @bailey2016tackling]. Frequent extreme events 
can help alter the mean temperature or precipitation of an area, 
can be associated with changes through time in the overall variance of 
climate signals, and can directly contribute to changes in the symmetry or the 
skewness of distributions of climate signals through time 
[@hansen2012perception]. All such changes have the potential to influence 
populations, including their risk of extirpation from an area 
[@GarciaCarerras2013; @Vasseuretal2014].
For instance, @frederiksen2008demographic used $43$ years of ring-recovery data 
to examine the demographic impact of ECEs on European shags 
via their effects on temporal variability in 
juvenile, immature and adult survival rates.
@mcdermott2017sensitivity investigated the sensitivity 
of $41$ UK butterfly species to four different types of ECEs. 
At the community level, research has shown that ECEs can reorder
the dominance hierarchy of species in an area, sometimes leading to 
selective local extinctions, and can also produce effects that cascade 
across trophic levels [@thomas2004extinction; @edgar2010nino; @moreno2011extreme; @hoover2014resistance]. 
For example, @chiu2013impact showed that extreme floods affected 
the annual survival of a prey community, in turn influencing predators in 
aquatic as well as adjacent riparian habitats. 
@dreesen2014successive, in an experimental study, showed that 
ECEs can reduce the ability of plant communities to withstand subsequent ECEs
that occur after a short time interval.

<!--Earlier study on metapopulation extinction risk : Large-scale spatial synchrony 
may also be generated by other processes such as migration and predation, but regional
stochasticity in the form of spatially correlated weather conditions is
probably the dominant synchronizing mechanism (ref: Nature1998) but what about taildep. effect on extrisk?.-->

<!--ECEs have impacts in the spatial context as well-->
ECEs also have impacts in ecological contexts for which spatial dynamics are
important.
In the metapopulation context, spatial synchrony of population dynamics, which can
be caused by spatial synchrony of climatic fluctuations [@Liebhold2004], is linked to metapopulation
extinction risk [@hanski1998metapopulation; @earn2000coherence].
If ECEs are also spatially more extensive than moderate events,
as seems likely for some types of events, extreme events may accentuate
population synchrony and thereby increase extinction risk.
For instance, a 21-year-long
study of @tack2015increasing on the Glanville fritillary butterfly demonstrated that frequency 
of drought during early larval instars increased the strength and extent 
of spatial synchrony 
over a metapopulation network of 4000 dry meadows, and could thereby influence
the long-term viability of the species in the area of study.

<!--concept for correlation in the extreme tail: tail association-->
Though earlier literature considered the influence of spatial synchrony 
in environmental variables on metapopulation extinction risk, to 
our knowledge the distinct influence of "asymmetric tail associations" between
environmental time series in different locations has hardly been considered. 
"Tail associations" are
associations between two random quantities in their extreme values. 
For instance, if two positively associated 
variables are more closely associated in their smaller values than in their larger values,
they are said to have stronger
"left-tail" or "lower-tail" association (Figure \ref{fig_intro_cop}A, B). 
If two positively associated variables are more associated in their larger 
values than in their smaller values, they are 
said to have stronger "right-tail" or "upper-tail" association 
(Figure \ref{fig_intro_cop}C, D). A precise definition of a measure of tail 
association is given in Methods.
Figure \ref{fig_intro_cop} shows that two variables can have a wide 
range of patterns of tail association, from extreme left- to extreme right-tail
association, with the same overall correlation. So tail association
is a distinct concept from correlation itself, and may have distinct ecological
ramifications [@Ghosh_copula]. Asymmetric tail associations have been documented 
between environmental variables, and between the same environmental variable 
measured in different places [@Serinaldi2008; @li2013; @She2018; @Goswami2018]. 
Asymmetric tail associations have also been documented between numerous ecological
variables and between environmental and ecological variables [@Ghosh_copula].

<!--***DAN: maybe you want to have a Discussion para on copulas. It could start with
some text about ranks being the proper way to study associations, and then could go
on to link to copulas and cite BIVAN-->

<!--ECEs probably produce tail associations-->
There are reasons to hypothesize that ECEs may produce asymmetric tail 
associations between climatic variables
measured in different locations. For instance, if a single ECE is associated
with spatially widespread, large values 
of some climatic variable, but small values of the
variable are associated with local weather rather than ECEs, the result could
be stronger right-tail association, through time, between measurements of the climatic variable
made in different locations.
For example, rainstorms which deposit exceptionally large amounts of rain
may do so over large areas; but periods with less rain may experience
scattered showers only, which may be much less correlated across locales.

<!--***DAN: May be scope for a discussion para linking what is known about
how ECEs are changing to what effect that may have on how tail assiciations
in environmental variables might be changing, and what influence that may have
on extinction risk. If little is known, then this might be a good topic for 
future work.-->

There are also reasons to hypothesize that asymmetry of tail association in 
environmental variables may influence extinction risks for metapopulations.
For instance, assuming for the sake of a simple example that low values of an environmental
variable are "bad" for populations of a given species and high values are "good",
greater left-tail associations between measurements of the variable in different
habitat patches may cause higher metapopulation extinction risk because then
very bad years for component populations would occur at the same time in 
many patches, reducing the potential for rescue effects. Greater right-tail associations
would probably not have the same effect, even if overall correlations between locations
were the same, because in that case it would be very good years for the component 
populations that would occur at the same time in many patches. 
@Ghosh_copula substantiated this intuition by showing that it held true for a 
modeling setup using a spatial version of a very simple non-density-dependent
population growth model (the Lewontin-Cohen model). In essence, if environmental
"catastrophes" (i.e., extremely bad years for a population) are widely 
spatially synchronized it should create much greater metapopulation extinction 
risk than if "bonanzas" (i.e., extremely good years) are widely synchronized, even
if overall (non-tail-specific) levels of environmental synchrony are the same
in both these scenarios. The present study extends tests of this idea to metapopulation
models incorporating density dependence. 

Extinction risk is also very commonly estimated for age-structured models 
such as stochastic matrix models [@MorrisDoak2002; @Caswell2006] and 
integral projection models
[@Merowetal2014]. For such models, extinction risk depends, in part, on the long-term
population growth rate, a population parameter which in turn 
depends on the means, variances and covariances of population vital rates such 
as the survival and fecundity rates of age classes. Extinction risks may,
*a priori*, also depend on possible asymmetries of tail association between
population vital rates. For instance, it seems reasonable to imagine
a case in which both adult fecundity and juvenile survival rates 
depend on an environmental variable such as spring rainfall in similar ways, but 
only when that variable takes low values. When rainfall takes
typical or high values, fecundity and survival may be limited instead 
by different factors. This could produce left-tail dependence between these 
vital rates, possibly resulting in different extinction risk for the model
compared to a case in which vital rates were symmetrically associated in 
their tails but otherwise statistically similar. 

<!--objectives, last para of intro-->
In this paper, we will explore the potential for asymmetric tail associations to 
influence extinction risk in populations and metapopulations. Specifically,
we will address the following sets of questions. Q1) Can the nature of tail associations
between vital rates in an age-structured population model influence
extinction risk for the model, and to what extent? Q2) Does the nature
of tail associations between measurements of an environmental variable in different
locations influence the extinction risk of a density-dependent metapopulation model
that depends on the environmental variable? How does the nature of the density
dependence mediate this influence? Will density dependence reverse or reproduce
the earlier result [@Ghosh_copula], using non-density-dependent models, that 
left-tail dependence in environmental variables accentuates and right-tail dependence 
mitigates extinction risks?
For Q1, we simulate a simple 2-stage model. We hypothesize that left-tail dependence
between juvenile survival and adult fecundity rates increases extinction risk
relative to right-tail dependence, even when the overall correlation is kept fixed. 
For Q2, we simulate spatial extensions of several simple and commonly
used population models. We intentionally use a simulation approach and simple models
instead of attempting mathematical analysis and/or using models that are more realistic, 
because our intention here is to provide an initial exploration only of 
the potential mechanisms, outlined above, which suggest that
asymmetries of tail association may make a difference for extinction risks. 
By so doing we hope to open these potentially practically important questions to 
wider examination other researchers. Some material in the Discussion outlines some possible next steps.
<!--***DAN: In Discussion need to talk about what analytic results are needed
to take the next step of determining when tail depencence may make enough of
a difference to think about. I think our results, together with Tulja's 
approximation, suggest that tail associations probably don't make much difference
for models without a spatial component. But our results illsutaret that it can
make a big difference when there is a spatial component, apparently because of 
the influence of tail associations on rescue effects. Could maybe even outline
analytic approaches for non-dd models? Not sure what would be done with dd
models. The point is you need to take the next step in the Discussion of 
talking about how our results, which admitedly are just for specific models,
could be turned into analytic results or general results. Interestingly, 
Tulja's approximation may also apply to the spatial case, at least when 
all locations can be reached from all other locations via dispersal. But the 
approximation seems poor in that case. Need to think about it more, and maybe
need more research.-->
Though tail associations are used
to assess risks in fields such as finance and hydrology 
[@alexander2008market; @li2013; @chen2011flood; @Goswami2018], to our
knowledge asymmetric tail associations have rarely been assessed for their
importance for extinction risks of populations and species (but see @Ghosh_copula). 
Our questions are an important step for understanding
the potential influence of ECEs on extinction risks if ECEs are related to
tail associations in environmental variables. 

<!--
How does environmental noises with asymmetric tail association across multiple patches
influence extinction risk of a density-dependent metapopulation model? Our speculation 
is that the general finding from density-independent metapopulation model [@Ghosh_copula]
(higher extinction risk if noises across patches were left-tail dependent than the one 
if noises had right-tail association) would hold true only in the under-compensatory regime, but 
should be reverse if the model shows over-compensatory dynamics. 
(Q3) We further hypothesize that when there is no dispersal, the above-said switching should occur
near the critical parameter value where the deterministic model shows transition from 
under-compensatory to over-compensatory dynamics.-->

<!--FIG : pedagogical fig showing 4 types of tail associations: 
extreme left, moderate left, moderate right, extreme right-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=15 cm]{./Results/introfig_copula.pdf}
\caption{Two stochastic quantities can have same Spearman 
correlation, but different degrees of tail association: 
(A) extreme left-tail association, (B) moderate left-tail association, (C) 
moderate right-tail association, and (D) extreme right-tail association.
In all cases, Spearman's $\rho$ was the same, $\rho =$ `r srho_common`,
up to sampling variance (the sample correlation for each dataset is displayed
on its panel). The extreme left-tail (respectively, right-tail) dependent 
case is perfectly correlated below (respectively, above) the threshold of 0.
See Methods for information on how bivariate noise was generated with
asymmetric tail associations.
\label{fig_intro_cop}}
\end{center}
\end{figure*}
<!--***DAN: Shyamolina, you put a negative sign in front of the Spearman correlations
on the C and D panels, but that is erroneous. The Spearman correlations are positive
in all four cases! Please fix!
***Shya: Yes, you are right, I fixed that.-->

# Methods\label{Methods}

<!--stochastic matrix model : age-structured-->
To investigate Q1 from the \nameref{Introduction},
we considered a simple stochastic age-structured model
with two age classes, 
\begin{equation}
\left({\begin{array}{cc} E(t+1) \\ A(t+1) \end{array}}\right) = 
\left(\begin{array}{cc} 0 & f_a(t)\\ s_e(t) & 0 \end{array}\right)
\left(\begin{array}{c} E(t) \\ A(t) \end{array}\right), \label{eq_age_str}
\end{equation}
\noindent where $E(t)$ and $A(t)$ are the numbers or population densities of eggs 
and adults, respectively, at time $t$. We chose a very simple model
because our goal was to carry out an initial evaluation, only, of 
the realism of a potential mechanism. The stochastic vital rates $s_e(t)$ and $f_a(t)$
were selected, independently across times, as follows. 
The egg survival rate $s_e(t)$ was drawn from a beta distribution with parameters
$\alpha=3$ and $\beta=2$. 
Adult fecundity was $f_a(t)=\tilde{f}_a(t)\exp(-A(t)/\Omega)$, where $\tilde{f}_a(t)$
was drawn from a gamma distribution with shape and scale parameters $k=2$
and $\theta=1$, respectively, 
and $\Omega$ is a density dependence parameter. Taking $\Omega=\infty$ made
$\exp(-A(t)/\Omega)=1$ so that the model did not include density dependence
(it was then a standard stochastic matrix model). Finite, positive values of 
$\Omega$ made the model nonlinear, with density dependence in the adult
fecundity rate.  

The stochastic quantities $s_e(t)$ and $\tilde{f}_a(t)$ were generated 
to have the same overall association (Spearman's $\rho$ equal to $0.875$,
up to sampling variance), but different degrees and types of 
asymmetry of tail association in different simulations, as follows.
For a simulation of length $T$, we used methods that can 
generate $T$ independent pairs $(u(t),v(t))$ for $t=1,\ldots,T$ with
$\rho=0.875$ (up to sampling variance), but with either extreme left-,
moderate left-, moderate right-, or extreme right-tail association 
(e.g., Fig. \ref{fig_intro_cop}). The methods we used generated
$(u(t),v(t))$ such that $u(t)$ was uniformly distributed on $(0,1)$,
and likewise for $v(t)$. We then applied a monotonic transformation
to the $u(t)$ so that the resulting numbers were distributed according to
a beta distribution with parameters
$\alpha=3$ and $\beta=2$, 
and we used those values for the $s_e(t)$. We also applied a (different)
monotonic transformation to the $v(t)$ so that the resulting numbers were
distributed according to a gamma distribution with parameters $k=2$
and $\theta=1$, and we used those values for the $\tilde{f}_a(t)$. Because
the $u(t)$ and $v(t)$ were uniformly distributed, the inverse 
cummulative distribution functions of the desired beta and
gamma distributions were the transformations. Because these
were monotonic transformations, the Spearman correlation of 
$s_e(t)$ and $\tilde{f}_a(t)$ was the same as that of 
$u(t)$ and $v(t)$. The quantities $(u(t),v(t))$ for $t=1,\ldots,T$ were
generated as described in Appendix \ref{SM-makenoise}.

<!--calculation of ext risk with age-structured model-->
To calculate extinction risk for a given $\Omega$ and choice of tail dependence, 
we simulated the model for $25$ time steps, $10000$ times,
each simulation starting from $E(t)=5$ and $A(t)=10$. The population for a simulation
was considered to have gone extinct if the total population $E(t)+A(t)$ ever 
went below an extinction threshold (we used $2$) within the 
$25$-time-step time horizon. Extinction risk was the fraction of $10000$
simulations that went extinct. Confidence intervals (95\%) of extinction
risk were also computed based on a binomial distribution.

The variables $u(t)$ and $v(t)$ are visibly asymmetrically tail associated (Fig. \ref{fig_intro_cop}),
but we have instead used the transformed variables $s_e(t)$ and $\tilde{f}_a(t)$
in our model. In what sense are $s_e(t)$ and $\tilde{f}_a(t)$ asymmetrically
tail associated? Given two boundary quantities $l_b$ and $u_b$ such
that $0 \leq l_b < u_b \leq 1$, and letting $x(t)$ be the rank of 
$u(t)$ in the set $\{u(t) | t=1,\ldots,T\}$ and letting 
$y(t)$ be the rank of 
$v(t)$ in the set $\{v(t) | i=1,\ldots,T\}$ (smallest elements
are here defined to have rank 1),
consider the portions of the 
lines $x+y = 2l_b$ and $x+y=2u_b$ which lie within the unit square
(Fig. \ref{PartialSpearmanFig}). 
<!--***DAN: Shyamolina, please make this figure. You can start from the code that 
make the similar figure in BIVAN (Fig. 7), but change it slightly so the figure is not
*exactly* the same. E.g., you could just switch from Clayton to survival Clayton data,
and maybe slightly change the locations of the bands. The caption can also be similar,
but obviously should not mention D^2 or P, and wording should be changed slightly.
The caption will also have to say something like "This figure was reproduced largely 
following Fig. 7 of Ghosh et al".
***Shya: see below.-->

<!--FIG : schematic diagram for partial spearman correlation, adapted from BIVAN-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=6 cm]{./Results/PartialSpearmanFig.pdf}
\caption{The partial Spearman correlation, $\cor_{lb,ub}(u, v)$, within a band can be computed
for any band to describe how the strength of association between $u$ and $v$
varies from one part of the two distributions to another. Diagonal lines 
show two bands, the data in the right/upper band showing
stronger association than those in the left/lower band. This figure was reproduced
largely following $Fig. 7$ of $Ghosh et al.(2019)$.
\label{PartialSpearmanFig}}
\end{center}
\end{figure*}


We can then define the *partial Spearman correlation*,
\begin{equation}
\cor_{l_b,u_b}(u,v) = \frac{\sum (x(t)-\mean(x))(y(t)-\mean(y))}{(n-1)\sqrt{\var(x) \var(y)}},\label{PartialSpearmanEq}
\end{equation}
\noindent where sample means and variances in this equation
are computed using all the data but the sum is computed only
over the $t$ such that $x(t)+y(t) > 2l_b$ and $x(t)+y(t)<2u_b$. 
The partial Spearman correlation is the component of the Spearman
correlation of $u$ and $v$ which can be attributed to the points
for which the ranks, $x$ and $y$, lie between the boundary lines
we defined in
the unit square (Fig. \ref{PartialSpearmanFig}). 
The quantity $\cor_{0,0.5}(u,v)-\cor_{0.5,1}(u,v)$ 
is a way to measure asymmetry of tail associations between
$u$ and $v$. And this quantity is the same as 
$\cor_{0,0.5}(s_e,\tilde{f}_a)-\cor_{0.5,1}(s_e,\tilde{f}_a)$, 
because the partial Spearman correlation, like the Spearman
correlation itself, is based on ranks. Ranks are the same
for $u(t)$ and for $s_e(t)$ because these quantities are 
related by an increasing monotonic transformation; and likewise for 
$v(t)$ and $\tilde{f}_a(t)$. Thus, in the sense captured
by the statistic $\cor_{0,0.5}-\cor_{0.5,1}$, $s_e(t)$
and $\tilde{f}_a(t)$ have the same asymmetry of tail
association as the values $u(t)$ and $v(t)$ from which they
were constructed. Rank-based approaches to understanding the nature
of association between variables have been recommended, as such
approaches are not influenced by the marginal distributions of
the quantities (e.g., @Genest2007). Marginal distributions contain no information
about association between variables, as each marginal pertains to
only one of the variables.

<!--density-dependence metapopulation model-->
To investigate Q2 from the \nameref{Introduction}, we considered spatialized, stochastic versions
of six density dependent population models, the Ricker, Hassell, Maynard Smith, Pennycuick, Verhulst, 
and Austin-Brewer models.
All models took the general form $\vec{P} (t+1) = D \lambda(t) \vec{P}(t)$,
where $\vec{P}(t)$ is a vector of population densities, 
the $i^{\text{th}}$ component $P_i(t)$ representing
the population density in the $i^{\text{th}}$ habitat patch ($i=1,2,\ldots,n$) at time $t$. 
The $n \times n$ matrix $\lambda(t)$ was diagonal with $i^{\text{th}}$ diagonal entry 
$\lambda_i(t)$ depending on the model used (Table \ref{tab_model_summary}). The matrix $D$
was an $n \times n$ dispersal matrix. For simplicity, 
we assumed the $n$ habitat patches were arranged, evenly spaced, in a line.
We considered both "local" and "global" dispersal among patches in different simulations. 
For local dispersal, a fraction $d$ of 
each population dispersed during each time step, equally distributed to
the two or one nearest neighbors. For global dispersal the same fraction $d$ dispersed
equally to the other $n-1$ patches. When $d$ was $0$, dispersal did not occur and 
rescue effects were not possible.

We obtained our list of classic population models (which we then spatialized and made 
stochastic, as above) from @cohen1995unexpected. 
Model parameters were selected so that varying the growth parameter, $r$, across a 
range, while keeping the other parameters fixed at selected values, 
caused the  deterministic, one-patch versions of the models to transition from dynamics
showing an undercompensatory (i.e., monotonic) approach to an equilibrium; to
dynamics showing an overcompensatory (i.e., oscillatory) approach to an equilibrium. 
The transition value of $r$ was denoted $r_c$. Appendix \ref{SM-model_stability}
summarizes stability analyses of the models.
Whereas @cohen1995unexpected
was interested in studying chaotic model behavior and therefore chose parameters
for which the models exhibited chaotic dynamics, we were interested in non-chaotic 
behaviors, which seem likely to be more common in real populations. 
Two models that @cohen1995unexpected 
used were excluded from our analyses because their functional forms complicated 
the analyses we wished to perform. First, the equilibrium of the 
Malthus-Condorcet-Mill model [@cohen1995unexpected] could not be determined 
analytically, making downstream analyses difficult for that model. Second, for
the Varley model and for the portions of parameter space we explored, 
varying $r$ produced no transition from under- to overcompensatory dynamics.

<!--***DAN: By the way, Shyamolina, these are not Hopf bifuractions - those cannot happen
with univariate models like these. These are called period-doubling bifucations.

***Shya: I also mentioned Hopf bifurcation in Appendix S2. I leave as it is, when you checked that 
we need to modify from hopf to period-doubling.

If $r$ became too high and exceeded $r_{bf}$ - the parameter value responsible for Hopf-bifurcation -
model equilibrium $P_e$ became unstable. Beyond the Hopf-bifurcation point, the model showed sustained
oscillation and eventually led to chaos with increasing $r$. Appendix \ref{SM-model_stability}
summarized the stability analysis of each model in their deterministic form.
-->

We simulated our metapopulation models using environmental noises $\epsilon_i(t)$ (Table \ref{tab_model_summary}), 
independent through time, that were generated to have the same overall associations 
between all patches and in all simulations (Spearman's $\rho$ again `r srho_common`, up to sampling variance), 
but with different degrees and types of asymmetry of tail associations 
between patches in different simulations, as follows. For a simulation of length $T$,
we used methods that can generate $T$ independent $n$-tuples $(u_1(t),\ldots,u_n(t))$
for $t=1,\ldots,T$ with $\rho=$ `r srho_common` between $u_i(t)$ and $u_j(t)$ for all $i \neq j$
(up to sampling variance), but with either extreme left-, moderate left-, moderate right-,
or extreme right-tail association between all pairs of locations (as in Fig. \ref{fig_intro_cop}). 
Pairs $u_i(t)$ and $u_j(t)$ looked like Fig. \ref{fig_intro_cop} and were structured, statistically,
in the same way as the stochastic quantities $u(t)$ and $v(t)$ used for the non-spatial 
simulations described above. For any $i$, $u_i(t)$ was again uniformly distributed on 
the interval $(0,1)$. To obtain the values $\epsilon_i(t)$, the $u_i(t)$ were 
transformed so that the resulting numbers were
normally distributed with mean $0$ and standard deviation $\sigma$ (Table \ref{tab_model_summary}), 
for all $i$. This was 
accomplished with the inverse cummulative distribution function of the normal distribution
with mean $0$ and standard deviation $\sigma$. Because this was a monotonic transformation,
the Spearman correlation between $\epsilon_i(t)$ and $\epsilon_j(t)$ was the same 
as that between $u_i(t)$ and $u_j(t)$; likewise partial Spearman correlations were the same. 
The quantities $(u_1(t),\ldots,u_n(t))$
for $t=1,\ldots,T$ were generated as described in Appendix \ref{SM-makenoise}.

To calculate extinction risk for a given metapopulation model, given parameters,
and a given choice of tail association,
we simulated the model for $25$ time steps, $10000$ times, using $n=5$ habitat patches.
The equilibrium value of the 
one-patch, deterministic version of the model, $P_e$ (Table \ref{tab_model_summary})
was used as the initial condition in all patches and simulations.
After each time step, if $P_i(t)$ was less than $P_e/10$ then it was set to $0$.
The whole metapopulation was considered to have gone extinct if all patches were $0$
a time step $25$.
<!--***DAN: Shyamolina, please check the above two sentences, is this what you did?
***Shya: I agreed with you upto line 482, the last line "The whole metapopulation was considered to have gone extinct if all patches were $0$ a time step $25$" I could not understand, did you write that conceptually? (then it's ok), 
or you meant I apply that in my code?
Similarly, the below line explains lines 149-150 of mydispersal.R, I am not fluent in using apply function on two dims at once e.g. c(1,3), you wrote that piece of code, I want to explain you 
on Friday gow I interpret that portion, then I can tell you accurately what I did.-->
Extinction risk was the fraction of 10000 metapopulations that went extinct. 
Estimates of extinction risk were plotted together with 95\% confidence intervals
based on a binomial distribution.

<!--***DAN: Dan plans to delete this text as it has been superseded by the above. Keeping it
around until I am sure the above is right:
Our models (Table \ref{tab_model_summary}) 
computed extinction risk after $25$ years for $10000$ simulations at $n = 5$ patches
with spatially correlated noises having either moderate or extreme tail 
association in left and right-tail. 
We started with initial population $P_{t=0}^i = P_e^i, (i = 1,2,\ldots,n)$ for each patch, where 
$P_e^i$ was the equilibrium value (or similar to carrying capacity concept) 
for each density-dependence model (see 4$^{th}$ column of Table \ref{tab_model_summary}).
We assumed the population went extinct after each time step if it was below a 
certain threshold (set to 10\% of the initial population $P_e$ for individual model). 
-->

<!--test hypothesis from Q2 : ext risk with density-dependence metapopulation model with r from different regime-->
To answer (Q2) of the \nameref{Introduction}, 
we estimated extinction risk for each metapopulation model, using each form of tail 
association for the environmental noise,
using values of $r$ that included under- and overcompensatory dynamics,
as indicated above. We chose values of $r$ within a range, the
range specified as follows. The second part of Q2 (about how density dependence mediates the
influence of asymmetric tail associations on extinction risk) was addressed by comparing
results for under- and overcompensatory model regimes.
Defining $r_{min}$ as the minimum value of $r$ 
for which $P_e$ was non-negative; and defining
$r_{bf}$ as the value of $r$ at which a bifurcation occurs, the range of
$r$ used spanned 95\% of the interval ($r_{min},r_{bf}$). For details, see Appendix 
\ref{SM-model_stability}. The range of $r$ encompassed $r_c$, so included 
a transition from under- to overcompensatory dynamics. For each value of $r$
used within the range, we calculated extinction risk as indicated above.
Dispersal parameter values $d= 0,0.1,0.2,..0.5$ were also used in different 
simulations. We plotted extinction risk as a function of $d$ for two
fixed values of $r$, one producing under- and one overcompensatory dynamics.
For $d=0$ we also plotted extinction risk as a function of $r$. All code for 
this project is available at https://github.com/sghosh89/ERC.

<!--
We plotted extinction risks along the y-axis
for both left tail and right tail associated noises 
against the varying range of $r$ along x-axis when no dispersal ($d=0$) was considered.
We excluded the possibility of dispersal to avoid any rescue effect among patches. 
For each model with extreme (or moderate) left- and right-tail associated noises, we calculated 
2.5$^{th}$ and 97.5$^{th}$ quantiles
of 10000 simulations with the probability of computed
extinction risks at each $r$. We compared $r_c$ and the value of $r$ at which 
95\% CI of extinction risks from both noises overlapped
with each other. This could give us an idea of how extinction risks affected by the model parameter 
$r$ that controlled the underlying dynamics of the model, i.e., undercompensatory 
or overcompensatory.
-->

# Results\label{Results}

<!--Q1 : age-structured model results-->
For our age-structured, non-spatial model, extinction risks were higher when 
associations between the vital rates $s_e$ and $f_a$ were principally for low values
of these vital rates (left-tail association), and were lower when associations
were principally for higher values; but the effect was minor for this model (Fig. \ref{fig_extrisk_agestr}).
Though extinction risks were overall higher for the density-dependent version of our model compared
to density-independent version, extinction risk differences across tail association 
scenarios were similar for the two versions. Because the same Spearman correlation (up to sampling
variance) was used in all simulations, the differences between lines in the panels
of Fig. \ref{fig_extrisk_agestr} are attributable solely to the changes we made in the
asymmetry of tail associations, and answer Q1. Though differences were significant (confidence
bands in Fig. \ref{fig_extrisk_agestr}, which are very narrow, did not overlap),
they were also small, corresponding to only a few percentage points of additional extinction
risk after 25 years. A potential reason for this outcome is elaborated in the Discussion.
<!--discussion later: add Tuljapurkar's approximation stuff-->

<!--Q2 : metapopulation results : density dependence with extreme tail dep. copula-->

We found density-dependent metapopulation models in stochastic 
environment showed similar patterns for extinction risk as density-independent 
metapopulation model did in a recent study [@Ghosh_copula]. For each density-dependent 
model listed in Table \ref{tab_model_summary}, we observed higher extinction risk for 
the metapopulations when spatially correlated noises were left-tail associated 
than the one with the right-tail association. But that observation remained 
valid when the model parameter - here considered as growth rate $(r)$ - was 
sufficiently low so that under-compensatory dynamics (monotonous approach towards
its stable equilibrium) for the deterministic analog of the model was ensured.
We observed right tail associated noise caused higher extinction 
risk for the metapopulations than left tail associated noise when the model 
was in over-compensatory regime (oscillatory approach towards stable equilibrium) for higher 
value of $r$. Fig. \ref{fig_extrisk_allmodel_localdisp} shows
variation of extinction risk against local dispersal rate ($d$) for 
six density dependent metapopulation models (see Table \ref{tab_model_summary}) with growth 
rate $r$ considered either from under-compensatory or 
from over-compensatory regime. This finding addresses (Q2) from \nameref{Introduction}. We 
also got similar results 
for global dispersal (Fig. \ref{SM-fig_extrisk_allmodel_globaldisp}). 
Figs. (\ref{SM-fig_ricker_risk_local_disp_scl_1} - 
\ref{SM-fig_risk_local_disp_abrewer_r_vary_scl_0.6}) 
demonstrate how extinction risk changed against local dispersal rate for a whole range
of $r$, whereas Figs. (\ref{SM-fig_ricker_risk_global_disp_scl_1} - 
\ref{SM-fig_risk_global_disp_abrewer_r_vary_scl_0.6}) 
represent the same but for global dispersal among patches. 
Both case showed the signature of "rescue-effect" (i.e. reduced the extinction risk for 
finite dispersal compared with $d=0$).

<!--Q3 : metapopulation results : switching near rc for d=0-->
Following Figs. (\ref{SM-fig_ricker_risk_local_disp_scl_1} - 
\ref{SM-fig_risk_global_disp_abrewer_r_vary_scl_0.6}) one can reasonably hypothesize
that the switching between the extinction risk 
generated by left-tail associated and right-tail associated noise 
occurred near the critical parameter $r_c$. For simplicity, we only considered 
$d=0$ case, i.e., when there was no dispersal between patches. 
Fig. \ref{fig_extrisk_d0} demonstrates higher extinction risk 
with left-tail associated noise for $r<r_c$ and with right-tail associated noise 
for $r>r_c$. $r_c$ was the vertical line in Fig. \ref{fig_extrisk_d0} 
indicating the value of $r$ for each model where their deterministic analog switches 
from under- to over-compensatory dynamics. Though the switching visually appeared far away
from the theoretical $r_c$ value for Verhulst and Austin-Brewer model, they were 
consistent with our hypothesis as they had comparatively a smaller range of $r$ than the other models.


# Discussion\label{Discussion}

<!--summary results:-->
We showed the potential use of the "asymmetric" tail association in modeling the impact of 
extreme ecological events on population-extinction risk. Our results demonstrated left and right-tail 
association in vital rates (or in spatially correlated environmental noises) affected extinction risk differently
in years of extreme events ("catastrophes" and "bonanzas"). Though we could expect the left tail association 
to show higher extinction risk than the one for right tail association with age-structured 
and density-dependent metapopulation models, it was not always true. In the over-compensatory regime,
right tail dependent noise caused higher extinction risk than the left tail dependent noise. We showed 
that in the absence of dispersal the above-said switching took place near the critical parameter value where 
the deterministic model showed the transition from under-compensatory to the over-compensatory regime.

<!--Tuljapurkar approximation : linear version of age-structured model in stochastic environments-->
We found a left tail association in vital rates (induced by ECEs) caused higher extinction risk than 
the right tail dependent ones, but the difference was not remarkable 
unless the tail association was at its 
extreme (Fig. \ref{fig_extrisk_agestr}). This finding could be explained 
by the approximation @tuljapurkar1990lecture made for the 
stochastic log(growth rate) in an iid environment.
The approximation considered growth rate being 
dependent on the most dominant eigenvalue of the mean projection matrix 
and the temporal variance of the log(population growth rate) caused 
by environmental stochasticity - which was based
on the linear covariance measure between any 
two matrix elements, not on their tail association properties. Therefore,
following @tuljapurkar1990lecture, the population growth 
rate in an iid environment could be approximated
as same for our model (Eq. \ref{eq_age_str}) with 
left-tail or right-tail association.

<!--Intution/ possible explanation for expected results/ hypo?-->



<!--future study: worthy for PVA, IUCN red list:
1. Identify which life stage or demographic process as management target?
2. Old study (Doak1994, Ferguson1995) showed including correlation btw vital rates for PVA makes a difference, 
   what if we include TD through copula? Multisite age str. model with dispersal, directional change
   in spatio-temporal variation for vital rates.
3. Tdep. with -ve correlation between vital rates?
4. extinction risk how propagated through a food web?
5. Not sure : see McCarthy2000: Most previous models of metapopulation viability have either ignored
correlated extinction of patches, or have included uniform correlations, with the correlation between 
nearby patches being the same as the correlation between distant
patches (Hanski 1994; Tilman et al. 1994; Lindenmayer et al. 1995; McCarthy
1996). 
-->
Although we demonstrated that tail association between vital rates of an age-structured model can
influence extinction risk, substantial work remains to determine the importance of this effect in the 
following scenarios. First, we demonstrated the effect of the tail association on extinction risk 
with a basic age-structured (two age stages) model where we considered the total semelparous 
population would go extinct if there would be only one female adult and one egg. But in reality population 
viability analysis (PVA) deals with a little bit higher threshold with several age, stage or size class and a variety 
of populations including semelparous and iteroparous [@morris2002quantitative]. Future studies should include 
tail association effect on extinction risk 
for a multiple age-, size- and stage-structured model and estimate extinction risk 
for each age, size and stage class separately 
so that we can identify (via multisite-PVA) which life-stage or demographic process 
to target for population management. An earlier study by @doak1994modeling showed PVA models with correlated 
demographic rates indicated a marked difference in predicting confidence interval for 
future population size compared with the model which did not include correlation. But when 
such correlation cannot be estimated directly, more generally where the
forms of statistical dependence among the model's parameters are unknown, making incorrect
assumptions about correlations and dependencies may lead to severe over-estimation 
or under-estimation of extinction risks [@ferson1995correlations]. We believe modeling 
dependencies with copula could help in this case. Second, we did not consider multiple sites of 
age-structured metapopulation which could be linked via dispersal. So, the possible future investigation 
would be to explore the viability for the metapopulations if vital rates (e.g. fecundity or 
survival of different stage class) across sites showed specific tail association 
with spatially correlated extreme climatic events. Third, we considered the tail association 
between positively correlated vital rates, but what would be the extinction risk 
and viability of a population if demographic rates were negatively correlated with the asymmetric tail association. 
We could consider this scenario to model extreme events that kill adults and allow more successful
recruitment of seeds or other propagules. Fourth, following the aforementioned idea, it would be worthy 
to model more complex prey-predator model where asymmetric tail association could feature the
interspecific-dependence. An earlier study [@carnicer2011widespread] showed extreme events
(i.e., heatwaves and droughts) increased mortality and defoliation in the southern European forest and its 
dependent herbivorous insects and fungi through trophic linkage. <!--ECEs can even truncate 
multiyear insect outbreak dynamics [@esper20061200].--> We believe copula (maybe a multidimensional one) has 
a lot more potential to estimate the risk of cascading extinction in model food webs. <!--should I mention about 
match-mismatch hypothesis leads to extinction? our phenology paper in prep.--> Fifth, we considered 
our metapopulation patches were equispaced on a linear chain with equal global dispersal 
rate between patches. But in realistic network models, as inter-patch distances 
can be different, the dispersal rate should depend on distance: dispersal is possible at higher 
rates between nearby patches than the patches which are far away. It is worthy to study 
metapopulation viability with non-uniform spatial correlation (i.e. asymmetric tail association) in a 
network with different clusters having various dispersal rates.

 <!--FIG : age structure model results : linear, nonlinear-->
\begin{figure*}[!h]
\textbf{ \hspace{5.4 cm} (A) \hspace{4 cm} (B)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_C_SC_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_C_SC_nonlinear_omg_100.pdf}\\
\end{center}
\textbf{ \hspace{5.4 cm} (C) \hspace{4 cm} (D)} \\
\vspace{-0.9 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_linear.pdf}
\includegraphics[width=5 cm]{./Results/age_str_results/extrisk_age_str_extremetail_nonlinear_omg_100.pdf}
\caption{Extinction risk versus time for our stochastic, age-structured model; risks
were higher when associations between vital rates were stronger in the left compared to
the right tails of the rates, but only slightly so. Results are for the linear
version of the model ($\Omega = \infty$; A, C) and for the nonlinear model with density
dependence in the fecundity rate ($\Omega = 100$; B, D). Results show cases of moderate
(A, B) and extreme (C, D) asymmetry of tail association. The solid line is the estimated extinction risk and the area of shading, which is barely visible because it is so narrow, show 95\% confidence intervals for extinction risk.\label{fig_extrisk_agestr}}
\end{center}
\end{figure*}

<!--FIG :  summary : all nonlinear model results for local dispersion : extrisk vs. d-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=14.5 cm]{./Results/allmodel_ext_risk_local_disp_extreme_and_moderate_noise.pdf}
\caption{Extinction risks are computed after $25$ years for six nonlinear density-dependence models (Table \ref{tab_model_summary}) with local dispersal among $n=5$ patches and for $10000$ simulations. Spatially correlated 
noises have varying degree of tail associations (extreme left tail, moderate left tail, moderate right tail and extreme right tail) as introduced in Fig. \ref{fig_intro_cop}. Last two columns represent variation of extinction risk against dispersal rate ($d$), calculated for intrinsic growth rate $(r)$ taken from under-compensatory and over-compensatory regime of deterministic model analog.\label{fig_extrisk_allmodel_localdisp}}
\end{center}
\end{figure*}


<!--FIG : all nonlinear model results, d=0, extrisk vs. r-->
\begin{figure*}[!h]
\begin{center}
\includegraphics[width=12 cm]{./Results/common_legend_extreme_and_moderate_noise.pdf}\\
\includegraphics[width=6 cm]{./Results/ricker_scl_1/ricker_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/hassell_scl_1/hassell_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=6 cm]{./Results/msmith_scl_0.8/msmith_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/pennycuick_scl_1/pennycuick_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\vspace{-0.6 cm}
\includegraphics[width=6 cm]{./Results/verhulst_scl_0.6/verhulst_extrisk_d0_extreme_and_moderate_noise.pdf}
\includegraphics[width=6 cm]{./Results/austinbrewer_scl_0.6/abrewer_extrisk_d0_extreme_and_moderate_noise.pdf}\\
\caption{Transition of higher to lower extinction risk (calculated after $25$ years) for 
the metapopulations affected by extreme left tail dependent noise across
$5$ multiple patches without dispersal ($d=0$), as intrinsic 
growth rate ($r$) goes from under to over-compensatory regime. Extinction risk for 
extreme right tail dependent noise follows the opposite trend.
Error bars represent the standard errors associated with $10000$
simulations for extinction risk computed at each $r$. Dotted line represents the value of $r$
for each model where their deterministic analog switches from under- to over-compensatory dynamics.
\label{fig_extrisk_d0}}
\end{center}
\end{figure*}

<!--Summary tables for 6 nonlinear models used-->
```{r read_tab_model_summary,echo=F, results='asis',message=F}
library(kableExtra)
library(dplyr)
dt<-readRDS("./Results/tab_model_summary.RDS")
knitr::kable(dt, escape=F,
             format="latex",digits=3, align="c",table.env='table*',
             caption = "Summary of the six density-dependent stochastic metapopulation models we used. The population growth rate in habitat patch $i$ at time $t$, $\\lambda_i(t)$ (second column), is $P_i(t+1)/P_i(t)$, and defines how the model works within each patch. Here $P_i(t)$ is the population in patch $i$ at time $t$. The growth rate depends on model parameters, $P_i(t)$, and the environment $\\epsilon_i(t)$ in patch $i$ at time $t$. $\\epsilon_i(t)$ was normally distributed with mean $0$ and standard deviation $\\sigma$, and values were generated independently across times. $P_e$ is the equilibrium of the deterministic, one-patch version of the model. $r_{min}$ is the smallest $r$, given fixed values of the other parameters, for which $P_e$ was non-negative. $r_c$ is the value of $r$ for which a transition occurs from under- to overcompensatory dynamics (see main text). $r_{bf}$ is the value of $r$ for which a transition occurs from a stable to an unstable equilbrium (a bifurcation; see main text). We used $r$ such that $r_{min}<r<r_{bf}$. Dispersal between patches was also implemented (see main text).\\label{tab_model_summary}",
             booktabs=T, linesep = "\\addlinespace"
             )%>%column_spec(c(1,3,5,6,7),width="1.4 cm")%>%kable_styling(latex_options = "basic",position = "center")%>%column_spec(2, width = "3.8 cm")
```
<!--***DAN: Shyamolina, can you please make the header of the second column read simply \lambda_i(t)? Also, can you add a column for r_min, please?
***Shya: Done, I added r_min value, if a population starts with exactly r=r_min, then P_e remains at 0, it should start with r>r_min to get a positive equilibrium.-->

\clearpage

# Literature cited

\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{1pt}
\noindent




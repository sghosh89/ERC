---
title: "extinction risk with one patch age structured model"
author: "Shyamolina Ghosh"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
seed<-101
source("mtime.R")
```

# Age structure model :

```{r sim_C_SC_G_SG, echo=F,  cache=T, cache.extra=list(seed,mtime("ext_risk_cop_age_str.R"))}
set.seed(seed)
source("ext_risk_cop_age_str.R")

numsims<-10000
numsteps<-100
p0<-c(5,10)
ext_thrs<-2
gshape<-2
gscale<-1
bshape1<-3
bshape2<-2
par_dist<-c(gshape,gscale,bshape1,bshape2)

ktau<-0.6  # kendall's tau

# for clayton
copC<-claytonCopula(3)
parC<-iTau(copC,tau=ktau)
par<-parC
fam<-3

cop<-BiCopSim(N=(numsteps*numsims), family = fam, par = par)

tempo<-paste("./Results/age_str_results/",BiCopName(family=fam),"_par_",par,"_ktau_",ktau,sep="")
if (!dir.exists(tempo)){
  dir.create(tempo)
}

resloc<-paste(tempo,"/",sep="")

C_age<-sim_age_str(p0=p0,ext_thrs = ext_thrs,cop=cop,par_dist = par_dist,
            numsims = numsims,numsteps = numsteps,ploton=T,resloc=resloc)
saveRDS(C_age,paste(resloc,BiCopName(family = fam),"_sim_age_str.RDS",sep=""))
#---------------------------------------------------------------------------------

# Now for survival clayton : should be the same parameter as of clayton if kendall's tau is the same 

fam<-13
par<-parC

cop<-BiCopSim(N=(numsteps*numsims), family = fam, par = par)

tempo<-paste("./Results/age_str_results/",BiCopName(family=fam),"_par_",par,"_ktau_",ktau,sep="")
if (!dir.exists(tempo)){
  dir.create(tempo)
}

resloc<-paste(tempo,"/",sep="")

SC_age<-sim_age_str(p0=p0,ext_thrs = ext_thrs,cop=cop,par_dist = par_dist,
            numsims = numsims,numsteps = numsteps,ploton=T,resloc=resloc)
saveRDS(SC_age,paste(resloc,BiCopName(family = fam),"_sim_age_str.RDS",sep=""))
#---------------------------------------------------------------------------------

# Now for gumbel 

fam<-4
copG<-gumbelCopula(2)
parG<-iTau(copG,tau = ktau)
par<-parG

cop<-BiCopSim(N=(numsteps*numsims), family = fam, par = par)

tempo<-paste("./Results/age_str_results/",BiCopName(family=fam),"_par_",par,"_ktau_",ktau,sep="")
if (!dir.exists(tempo)){
  dir.create(tempo)
}

resloc<-paste(tempo,"/",sep="")

G_age<-sim_age_str(p0=p0,ext_thrs = ext_thrs,cop=cop,par_dist = par_dist,
            numsims = numsims,numsteps = numsteps,ploton=T,resloc=resloc)
saveRDS(G_age,paste(resloc,BiCopName(family = fam),"_sim_age_str.RDS",sep=""))

#---------------------------------------------------------------------------------

# Now for survival gumbel : should be the same parameter as of gumbel if kendall's tau is the same 

fam<-14
par<-parG

cop<-BiCopSim(N=(numsteps*numsims), family = fam, par = par)

tempo<-paste("./Results/age_str_results/",BiCopName(family=fam),"_par_",par,"_ktau_",ktau,sep="")
if (!dir.exists(tempo)){
  dir.create(tempo)
}

resloc<-paste(tempo,"/",sep="")

SG_age<-sim_age_str(p0=p0,ext_thrs = ext_thrs,cop=cop,par_dist = par_dist,
            numsims = numsims,numsteps = numsteps,ploton=T,resloc=resloc)
saveRDS(SG_age,paste(resloc,BiCopName(family = fam),"_sim_age_str.RDS",sep=""))
#---------------------------------------------------------------------------------
```

```{r fig_extrisk_agestr_C_SC_G_SG, echo=F,results="hide"}

res_age_C<-readRDS("./Results/age_str_results/C_par_3_ktau_0.6/C_sim_age_str.RDS")
res_age_SC<-readRDS("./Results/age_str_results/SC_par_3_ktau_0.6/SC_sim_age_str.RDS")
res_age_G<-readRDS("./Results/age_str_results/G_par_2.5_ktau_0.6/G_sim_age_str.RDS")
res_age_SG<-readRDS("./Results/age_str_results/SG_par_2.5_ktau_0.6/SG_sim_age_str.RDS")

xC<-res_age_C$extdf
xSC<-res_age_SC$extdf
xG<-res_age_G$extdf
xSG<-res_age_SG$extdf

t<-c(0:(nrow(xC)-1))

pdf(paste("./Results/age_str_results/extrisk_age_str_C_SC_G_SG_ktau_",ktau,".pdf",sep=""),height=6,width=12)
op<-par(mfrow=c(1,2),mar=c(4,4,2,2),mgp=c(2.5,0.5,0))

# for C, SC
plot(0,-1,ylim=c(0,1),xlim=range(t),ylab="Extinction risk",xlab="time",cex.lab=1.5,panel.first=grid())

x<-xC
polygon(c(rev(t), t), c(rev(x$CI0.975), x$CI0.025), col = rgb(0,0,0,0.3), border = NA)
lines(t,x$erA,col="black",type="l")

x<-xSC
polygon(c(rev(t), t), c(rev(x$CI0.975), x$CI0.025), col = rgb(1,0,0,0.3), border = NA)
lines(t,x$erA,col="red",type="l")

legend("topleft", c("C","SC"), lty=c(1,1),  
       col=c('black', 'red'), horiz=F, bty='n', cex=1.2)

# for G, SG
plot(0,-1,ylim=c(0,1),xlim=range(t),ylab="Extinction risk",xlab="time",cex.lab=1.5,panel.first=grid())

x<-xG
polygon(c(rev(t), t), c(rev(x$CI0.975), x$CI0.025), col = rgb(0,0,0,0.3), border = NA)
lines(t,x$erA,col="black",type="l")

x<-xSG
polygon(c(rev(t), t), c(rev(x$CI0.975), x$CI0.025), col = rgb(1,0,0,0.3), border = NA)
lines(t,x$erA,col="red",type="l")

legend("topleft", c("G","SG"), lty=c(1,1),  
       col=c('black', 'red'), horiz=F, bty='n', cex=1.2)

par(op)
dev.off()
```


![Extinction risk from one patch age structured model, fecundity of adults and survival of eggs have different asymmetric copula atructure but with same kendall correlation = 0.6, numsims=10000.\label{fig_extrisk_agestr}](./Results/age_str_results/extrisk_age_str_C_SC_G_SG_ktau_0.6.pdf){ width=40%, height=40% }



























